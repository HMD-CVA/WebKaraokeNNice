<div class="main-content">
  <div class="admin-dashboard">
    <!-- Header Premium -->
    <div class="dashboard-header">
      <div class="header-content">
        <div class="header-title">
          <div class="title-icon">üîß</div>
          <div>
            <h1>QU·∫¢N L√ù THI·∫æT B·ªä</h1>
            <p>Theo d√µi v√† qu·∫£n l√Ω thi·∫øt b·ªã ph√≤ng h√°t karaoke</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn-primary" onclick="openThietBiModal()">
            <i class="fas fa-plus"></i>
            <span>Th√™m thi·∫øt b·ªã</span>
          </button>
          <button class="btn-secondary" onclick="openBaoTriModal()">
            <i class="fas fa-tools"></i>
            <span>Th√™m b·∫£o tr√¨</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Search and Filter Bar -->
    <div class="search-filter-bar">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm thi·∫øt b·ªã..." onkeyup="filterThietBi()">
        <button class="search-btn" onclick="filterThietBi()">T√¨m ki·∫øm</button>
      </div>
      <div class="filter-controls">
        <select class="filter-select" id="statusFilter" onchange="filterThietBi()">
          <option value="">T·∫•t c·∫£ t√¨nh tr·∫°ng</option>
          <option value="T·ªët">T·ªët</option>
          <option value="ƒêang b·∫£o tr√¨">ƒêang b·∫£o tr√¨</option>
          <option value="H·ªèng">H·ªèng</option>
          <option value="C·∫ßn s·ª≠a ch·ªØa">C·∫ßn s·ª≠a ch·ªØa</option>
        </select>
        <select class="filter-select" id="loaiFilter" onchange="filterThietBi()">
          <option value="">T·∫•t c·∫£ lo·∫°i</option>
          {{#each loaiThietBis}}
          <option value="{{this}}">{{this}}</option>
          {{/each}}
          <option value="Kh√°c">Kh√°c</option>
        </select>
        <button class="clear-filters" onclick="clearFilters()">
          <i class="fas fa-times"></i>
          X√≥a l·ªçc
        </button>
      </div>
    </div>

    <!-- Stats Overview -->
    <div class="stats-overview">
      {{#each thietbisThongKe}}
      <div class="stat-card">
        <div class="{{this.bgColor}}">
          <i class="{{this.icon}}"></i>
        </div>
        <div class="stat-info">
          <h3 id="statTotal">{{this.SoLuong}}</h3>
          <p>{{this.TinhTrang}}</p>
        </div>
      </div>
      {{/each}}
    </div>
    {{!-- <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon total">
          <i class="fas fa-microphone"></i>
        </div>
        <div class="stat-info">
          <h3 id="statTotal">0</h3>
          <p>T·ªïng thi·∫øt b·ªã</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon active">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-info">
          <h3 id="statGood">0</h3>
          <p>Thi·∫øt b·ªã t·ªët</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon reception">
          <i class="fas fa-tools"></i>
        </div>
        <div class="stat-info">
          <h3 id="statMaintenance">0</h3>
          <p>ƒêang b·∫£o tr√¨</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon service">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-info">
          <h3 id="statBroken">0</h3>
          <p>Thi·∫øt b·ªã h·ªèng</p>
        </div>
      </div>
    </div> --}}

    <!-- Room Navigation -->
    <div class="room-navigation" id="roomNavigation">
      <!-- Room buttons will be dynamically generated -->
    </div>

    <!-- ThietBi Grid -->
    <div class="rooms-grid" id="thietBiGrid">
      {{#each thietbis}}
      <div class="room-card" data-id="{{this._id}}" data-matb="{{this.MaThietBi}}" data-maphong="{{this.MaPhong}}"
        data-tenthietbi="{{this.TenThietBi}}" data-tinhtrang="{{this.TinhTrang}}" data-loai="{{this.LoaiThietBi}}">
        <div class="room-image">
          {{#if this.LinkAnh}}
          <img src="{{this.LinkAnh}}" alt="{{this.TenThietBi}}">
          {{else}}
          <div class="employee-avatar-placeholder device {{this.LoaiThietBi}}">
            <i class="{{getDeviceIcon this.LoaiThietBi}}"></i>
          </div>
          {{/if}}
          <div class="room-overlay">
            <div class="room-actions">
              <button class="btn-edit" onclick="viewBaoTriHistory('{{this.MaThietBi}}')">
                <i class="fas fa-history"></i>
              </button>
              <button class="btn-edit" onclick="editThietBi('{{this.MaThietBi}}')">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-delete" onclick="deleteThietBi('{{this.MaThietBi}}', '{{this.TenThietBi}}')">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          <div class="room-badge {{this.LoaiThietBi}}">
            {{this.LoaiThietBi}}
          </div>
          <div
            class="room-status {{#if (eq this.TinhTrang 'T·ªët')}}active{{else if (eq this.TinhTrang 'ƒêang b·∫£o tr√¨')}}onleave{{else}}inactive{{/if}}">
            {{this.TinhTrang}}
          </div>
        </div>

        <div class="room-content">
          <h3 class="room-title">{{this.TenThietBi}}</h3>
          <p class="room-code">M√£: {{this.MaThietBi}}</p>
          <p class="room-phong">Ph√≤ng: {{this.MaPhong}}</p>

          <div class="room-details">
            <div class="detail-item">
              <i class="fas fa-calendar-alt"></i>
              <span>Ng√†y nh·∫≠p: {{formatDate this.NgayNhap}}</span>
            </div>
            {{#if this.HangSanXuat}}
            <div class="detail-item">
              <i class="fas fa-industry"></i>
              <span>H√£ng: {{this.HangSanXuat}}</span>
            </div>
            {{/if}}
            {{#if this.Model}}
            <div class="detail-item">
              <i class="fas fa-barcode"></i>
              <span>Model: {{this.Model}}</span>
            </div>
            {{/if}}
            {{#if this.GiaTri}}
            <div class="detail-item">
              <i class="fas fa-money-bill-wave"></i>
              <span>Gi√° tr·ªã: {{formatCurrency this.GiaTri}}</span>
            </div>
            {{/if}}
          </div>

          <!-- L·ªãch s·ª≠ b·∫£o tr√¨ g·∫ßn nh·∫•t -->
          {{#if this.BaoTriGanNhat}}
          <div class="maintenance-history">
            <h4>B·∫£o tr√¨ g·∫ßn nh·∫•t:</h4>
            <div class="maintenance-item">
              <span class="maintenance-date">{{formatDate this.BaoTriGanNhat.ThoiGian}}</span>
              <span class="maintenance-cost">{{formatCurrency this.BaoTriGanNhat.ChiPhi}}</span>
            </div>
            <p class="maintenance-desc">{{this.BaoTriGanNhat.MoTa}}</p>
          </div>
          {{/if}}

          <div class="room-footer">
            <span class="room-id">#{{this.MaThietBi}}</span>
            <button class="btn-status" onclick="toggleStatus('{{this.MaThietBi}}', '{{this.TinhTrang}}')">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
        </div>
      </div>
      {{/each}}
    </div>

    <!-- Empty State -->
    <div class="empty-state" id="emptyState"
      style="{{#if thietbis.length}}display: none;{{else}}display: block;{{/if}}">
      <div class="empty-icon">üîß</div>
      <h3>Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã</h3>
      <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c th√™m thi·∫øt b·ªã m·ªõi</p>
      <button class="btn-primary" onclick="openThietBiModal()">
        <i class="fas fa-plus"></i>
        Th√™m thi·∫øt b·ªã ƒë·∫ßu ti√™n
      </button>
    </div>
  </div>

  <!-- ThietBi Modal -->
  <div class="modal-overlay" id="thietBiModal" style="display: none;">
    <div class="modal-container">
      <div class="modal-header">
        <h2 id="modalTitle">Th√™m thi·∫øt b·ªã m·ªõi</h2>
        <button class="modal-close" onclick="closeThietBiModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <form id="thietBiForm" onsubmit="saveThietBi(event)">
          <input type="hidden" id="thietBiId">
          <input type="hidden" id="thietBiMaTB">
          <input type="hidden" id="thietBiForm">

          <div class="form-grid">
            <div class="form-group">
              <label for="thietBiName">T√™n thi·∫øt b·ªã *</label>
              <input type="text" id="thietBiName" required placeholder="Nh·∫≠p t√™n thi·∫øt b·ªã">
            </div>

            <div class="form-group">
              <label for="thietBiMaPhong">M√£ ph√≤ng *</label>
              <select id="thietBiMaPhong" required>
                <option value="">Ch·ªçn ph√≤ng</option>
                {{#each uniqueMaPhongs}}
                <option value="{{this}}">{{this}}</option>
                {{/each}}
                <option value="Kh√°c">Kh√°c</option>
              </select>
            </div>

            <div class="form-group">
              <label for="thietBiLoai">Lo·∫°i thi·∫øt b·ªã *</label>
              <select id="thietBiLoai" required>
                <option value="">Ch·ªçn lo·∫°i thi·∫øt b·ªã</option>
                {{#each loaiThietBis}}
                <option value="{{this}}">{{this}}</option>
                {{/each}}
                <option value="Kh√°c">Kh√°c</option>
              </select>
            </div>

            <div class="form-group">
              <label for="thietBiStatus">T√¨nh tr·∫°ng *</label>
              <select id="thietBiStatus" required>
                <option value="T·ªët">T·ªët</option>
                <option value="ƒêang b·∫£o tr√¨">ƒêang b·∫£o tr√¨</option>
                <option value="C·∫ßn s·ª≠a ch·ªØa">C·∫ßn s·ª≠a ch·ªØa</option>
                <option value="H·ªèng">H·ªèng</option>
              </select>
            </div>

            <div class="form-group">
              <label for="thietBiNgayNhap">Ng√†y nh·∫≠p</label>
              <input type="date" id="thietBiNgayNhap">
            </div>

          </div>

          <div class="form-group full-width">
            <label for="thietBiAvatar">Link ·∫£nh thi·∫øt b·ªã</label>
            <input type="text" id="thietBiAvatar" placeholder="URL h√¨nh ·∫£nh" oninput="updateThietBiPreview(this.value)">
          </div>

          <div class="form-group full-width" id="thietBiPreviewContainer">
            <label>Preview ·∫£nh thi·∫øt b·ªã</label>
            <div class="image-preview" id="thietBiPreview">
              <i class="fas fa-microphone"></i>
              <p>Preview s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</p>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" type="button" onclick="closeThietBiModal()">H·ªßy</button>
        <button class="btn-primary" type="submit" form="thietBiForm">L∆∞u th√¥ng tin</button>
      </div>
    </div>
  </div>

  <!-- BaoTri Modal -->
  <div class="modal-overlay" id="baoTriModal" style="display: none;">
    <div class="modal-container">
      <div class="modal-header">
        <h2>Th√™m l·ªãch s·ª≠ b·∫£o tr√¨</h2>
        <button class="modal-close" onclick="closeBaoTriModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <form id="baoTriForm" onsubmit="saveBaoTri(event)">
          <input type="hidden" id="baoTriId">

          <div class="form-grid">
            <div class="form-group">
              <label for="baoTriMaThietBi">Thi·∫øt b·ªã *</label>
              <select id="baoTriMaThietBi" required onchange="updateThietBiInfo()">
                <option value="">Ch·ªçn thi·∫øt b·ªã</option>
                {{#each thietbis}}
                <option value="{{this.MaThietBi}}" data-tenthietbi="{{this.TenThietBi}}"
                  data-maphong="{{this.MaPhong}}">
                  {{this.MaThietBi}} - {{this.TenThietBi}} ({{this.MaPhong}})
                </option>
                {{/each}}
              </select>
            </div>

            <div class="form-group">
              <label for="baoTriTenThietBi">T√™n thi·∫øt b·ªã</label>
              <input type="text" id="baoTriTenThietBi" readonly>
            </div>

            <div class="form-group">
              <label for="baoTriMaPhong">Ph√≤ng</label>
              <input type="text" id="baoTriMaPhong" readonly>
            </div>

            <div class="form-group">
              <label for="baoTriChiPhi">Chi ph√≠ (VND) *</label>
              <input type="number" id="baoTriChiPhi" required placeholder="Nh·∫≠p chi ph√≠ b·∫£o tr√¨">
            </div>

            <div class="form-group">
              <label for="baoTriThoiGian">Th·ªùi gian b·∫£o tr√¨ *</label>
              <input type="datetime-local" id="baoTriThoiGian" required>
            </div>

            <div class="form-group full-width">
              <label for="baoTriMoTa">M√¥ t·∫£ b·∫£o tr√¨ *</label>
              <textarea id="baoTriMoTa" required placeholder="M√¥ t·∫£ c√¥ng vi·ªác b·∫£o tr√¨/s·ª≠a ch·ªØa" rows="3"></textarea>
            </div>

            <div class="form-group full-width">
              <label for="baoTriNhanVien">Nh√¢n vi√™n th·ª±c hi·ªán</label>
              <input type="text" id="baoTriNhanVien" placeholder="T√™n nh√¢n vi√™n b·∫£o tr√¨">
            </div>

            <div class="form-group full-width">
              <label for="baoTriKetQua">K·∫øt qu·∫£ b·∫£o tr√¨</label>
              <select id="baoTriKetQua">
                <option value="">Ch·ªçn k·∫øt qu·∫£</option>
                <option value="ƒê√£ s·ª≠a xong">ƒê√£ s·ª≠a xong</option>
                <option value="C·∫ßn thay th·∫ø linh ki·ªán">C·∫ßn thay th·∫ø linh ki·ªán</option>
                <option value="Ch·ªù x·ª≠ l√Ω">Ch·ªù x·ª≠ l√Ω</option>
                <option value="Kh√¥ng th·ªÉ s·ª≠a">Kh√¥ng th·ªÉ s·ª≠a</option>
              </select>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" type="button" onclick="closeBaoTriModal()">H·ªßy</button>
        <button class="btn-primary" type="submit" form="baoTriForm">L∆∞u b·∫£o tr√¨</button>
      </div>
    </div>
  </div>

  <!-- L·ªãch s·ª≠ b·∫£o tr√¨ Modal -->
  <div class="modal-overlay" id="historyModal" style="display: none;">
    <div class="modal-container large">
      <div class="modal-header">
        <h2 id="historyTitle">L·ªãch s·ª≠ b·∫£o tr√¨</h2>
        <button class="modal-close" onclick="closeHistoryModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="history-list" id="historyList">
          <!-- Danh s√°ch l·ªãch s·ª≠ b·∫£o tr√¨ s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JS -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeHistoryModal()">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div>
    {{{pagination 'thietbi' page totalPages totalItems}}}
  </div>

</div>





<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  // ===== CONFIGURATION & STATE =====
  let allThietBis = [];
  let filteredThietBis = [];
  let currentThietBiHistory = [];
  let currentRoomFilter = 'all';

  // ===== INITIALIZATION =====
  document.addEventListener('DOMContentLoaded', function () {
    initializeApp();
  });

  function initializeApp() {
    // Kh·ªüi t·∫°o d·ªØ li·ªáu v√† giao di·ªán
    allThietBis = Array.from(document.querySelectorAll('.room-card'));
    filteredThietBis = [...allThietBis];

    calculateStatistics();
    initRoomNavigation();
    setupEventListeners();
  }

  function setupEventListeners() {
    // Setup real-time search
    const searchInput = document.getElementById('searchInput');
    let searchTimeout;

    if (searchInput) {
      searchInput.addEventListener('input', function () {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          filterThietBi();
        }, 300);
      });
    }

    // Close modals when clicking outside
    document.addEventListener('click', function (event) {
      const thietBiModal = document.getElementById('thietBiModal');
      const baoTriModal = document.getElementById('baoTriModal');
      const historyModal = document.getElementById('historyModal');

      if (event.target === thietBiModal) closeThietBiModal();
      if (event.target === baoTriModal) closeBaoTriModal();
      if (event.target === historyModal) closeHistoryModal();
    });

    // Close modals with Escape key
    document.addEventListener('keydown', function (event) {
      if (event.key === 'Escape') {
        closeThietBiModal();
        closeBaoTriModal();
        closeHistoryModal();
      }
    });
  }

  // ===== STATISTICS CALCULATION =====
  function calculateStatistics() {
    const thietBis = allThietBis;

    const totalThietBis = thietBis.length;
    const countGood = thietBis.filter(tb =>
      tb.getAttribute('data-tinhtrang') === 'T·ªët'
    ).length;

    const countMaintenance = thietBis.filter(tb =>
      tb.getAttribute('data-tinhtrang') === 'ƒêang b·∫£o tr√¨'
    ).length;

    const countBroken = thietBis.filter(tb =>
      tb.getAttribute('data-tinhtrang') === 'H·ªèng'
    ).length;

    // updateStatCard('#statTotal', totalThietBis);
    // updateStatCard('#statGood', countGood);
    // updateStatCard('#statMaintenance', countMaintenance);
    // updateStatCard('#statBroken', countBroken);
  }

  function updateStatCard(selector, value) {
    const element = document.querySelector(selector);
    if (element) {
      animateValue(element, 0, value, 1000);
    }
  }

  function animateValue(element, start, end, duration) {
    let startTimestamp = null;
    const step = (timestamp) => {
      if (!startTimestamp) startTimestamp = timestamp;
      const progress = Math.min((timestamp - startTimestamp) / duration, 1);
      element.textContent = Math.floor(progress * (end - start) + start);
      if (progress < 1) {
        window.requestAnimationFrame(step);
      }
    };
    window.requestAnimationFrame(step);
  }

  // ===== ROOM NAVIGATION =====
  function initRoomNavigation() {
    const roomNavigation = document.getElementById('roomNavigation');
    if (!roomNavigation) return;

    // L·∫•y t·∫•t c·∫£ c√°c ph√≤ng t·ª´ d·ªØ li·ªáu thi·∫øt b·ªã
    const rooms = [...new Set(allThietBis.map(card => card.getAttribute('data-maphong')))].filter(room => room);

    // Th√™m n√∫t "T·∫•t c·∫£"
    const allButton = document.createElement('button');
    allButton.className = 'room-nav-btn active';
    allButton.setAttribute('data-room', 'all');
    allButton.innerHTML = '<i class="fas fa-th-large"></i><span>T·∫•t c·∫£</span>';
    roomNavigation.appendChild(allButton);

    // Th√™m n√∫t cho t·ª´ng ph√≤ng
    rooms.forEach(room => {
      const roomButton = document.createElement('button');
      roomButton.className = 'room-nav-btn';
      roomButton.setAttribute('data-room', room);
      roomButton.innerHTML = `<i class="fas fa-door-closed"></i><span>${room}</span>`;
      roomNavigation.appendChild(roomButton);
    });

    // Th√™m n√∫t "Kh√°c" cho c√°c thi·∫øt b·ªã kh√¥ng c√≥ ph√≤ng
    const otherButton = document.createElement('button');
    otherButton.className = 'room-nav-btn';
    otherButton.setAttribute('data-room', 'other');
    otherButton.innerHTML = '<i class="fas fa-question-circle"></i><span>Kh√°c</span>';
    roomNavigation.appendChild(otherButton);

    // Th√™m s·ª± ki·ªán click cho c√°c n√∫t
    roomNavigation.addEventListener('click', function (e) {
      if (e.target.closest('.room-nav-btn')) {
        const clickedButton = e.target.closest('.room-nav-btn');
        const room = clickedButton.getAttribute('data-room');

        // X√≥a active class t·ª´ t·∫•t c·∫£ c√°c n√∫t
        document.querySelectorAll('.room-nav-btn').forEach(btn => {
          btn.classList.remove('active');
        });

        // Th√™m active class cho n√∫t ƒë∆∞·ª£c click
        clickedButton.classList.add('active');

        // C·∫≠p nh·∫≠t b·ªô l·ªçc ph√≤ng
        currentRoomFilter = room;

        // L·ªçc thi·∫øt b·ªã
        filterThietBi();
      }
    });
  }

  // ===== THIET BI MANAGEMENT =====
  function openThietBiModal(thietBiData = null) {
    console.log(thietBiData);

    const modal = document.getElementById('thietBiModal');
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';

    if (thietBiData) {
      document.getElementById('modalTitle').textContent = 'Ch·ªânh s·ª≠a thi·∫øt b·ªã';
      populateThietBiForm(thietBiData);
    } else {
      document.getElementById('modalTitle').textContent = 'Th√™m thi·∫øt b·ªã m·ªõi';
      resetThietBiForm();
    }
  }

  function populateThietBiForm(data) {
    document.getElementById('thietBiId').value = data._id;
    document.getElementById('thietBiMaTB').value = data.MaThietBi;
    document.getElementById('thietBiName').value = data.TenThietBi || '';
    document.getElementById('thietBiMaPhong').value = data.MaPhong || '';
    document.getElementById('thietBiLoai').value = data.LoaiThietBi || '';
    document.getElementById('thietBiStatus').value = data.TinhTrang || 'T·ªët';
    document.getElementById('thietBiNgayNhap').value = data.NgayNhap ? new Date(data.NgayNhap).toISOString().split('T')[0] : '';
    document.getElementById('thietBiAvatar').value = data.LinkAnh || '';
    updateThietBiPreview(data.LinkAnh || '');
  }

  function closeThietBiModal() {
    document.getElementById('thietBiModal').style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  function resetThietBiForm() {
    document.getElementById('thietBiForm').reset();
    document.getElementById('thietBiId').value = '';
    document.getElementById('thietBiMaTB').value = '';
    document.getElementById('thietBiStatus').value = 'T·ªët';
    document.getElementById('thietBiNgayNhap').value = new Date().toISOString().split('T')[0];
    updateThietBiPreview('');
  }

  function updateThietBiPreview(avatarUrl) {
    const preview = document.getElementById('thietBiPreview');
    if (avatarUrl && avatarUrl.trim() !== '') {
      preview.innerHTML = `<img src="${avatarUrl}" alt="Preview">`;
    } else {
      preview.innerHTML = '<i class="fas fa-microphone"></i><p>Preview s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</p>';
    }
  }

  function handleImageError(img) {
    img.style.display = 'none';
    const preview = document.getElementById('thietBiPreview');
    preview.innerHTML = '<i class="fas fa-microphone"></i><p>Kh√¥ng th·ªÉ t·∫£i ·∫£nh</p>';
  }

  async function saveThietBi(event) {
    event.preventDefault();

    const formData = getThietBiFormData();
    const validation = validateThietBiForm(formData);

    if (!validation.isValid) {
      showError(validation.message);
      return;
    }

    const isEdit = !!document.getElementById('thietBiMaTB').value;
    const url = isEdit ? `/api/thietbi/${document.getElementById('thietBiMaTB').value}` : '/api/thietbi';
    const method = isEdit ? 'PUT' : 'POST';
    console.log(document.getElementById('thietBiMaTB').value, document.getElementById('thietBiId').value, isEdit, url, method);

    try {
      await showLoading('ƒêang l∆∞u th√¥ng tin...');  

      const response = await fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });

      Swal.close();
    
      const result = await handleResponse(response);
      await showSuccess(`Thi·∫øt b·ªã "${formData.MaThietBi}" ƒë√£ ƒë∆∞·ª£c ${isEdit ? 'c·∫≠p nh·∫≠t' : 'th√™m'} th√†nh c√¥ng!`);

      setTimeout(() => {
        location.reload();
      }, 500);

    } catch (error) {
      handleError('L·ªói khi l∆∞u thi·∫øt b·ªã:', error);
    }
  }

  function getThietBiFormData() {
    return {
      MaThietBi: document.getElementById('thietBiMaTB').value,
      TenThietBi: document.getElementById('thietBiName').value.trim(),
      MaPhong: document.getElementById('thietBiMaPhong').value,
      LoaiThietBi: document.getElementById('thietBiLoai').value,
      TinhTrang: document.getElementById('thietBiStatus').value,
      NgayNhap: document.getElementById('thietBiNgayNhap').value || new Date().toISOString(),
      LinkAnh: document.getElementById('thietBiAvatar').value.trim()
    };
  }

  function validateThietBiForm(data) {
    if (!data.TenThietBi) {
      return { isValid: false, message: 'Vui l√≤ng nh·∫≠p t√™n thi·∫øt b·ªã' };
    }
    if (!data.MaPhong) {
      return { isValid: false, message: 'Vui l√≤ng ch·ªçn ph√≤ng' };
    }
    if (!data.LoaiThietBi) {
      return { isValid: false, message: 'Vui l√≤ng ch·ªçn lo·∫°i thi·∫øt b·ªã' };
    }
    return { isValid: true };
  }

  async function editThietBi(maThietBi) {
    try {
      const response = await fetch(`/api/thietbi/${maThietBi}`);
      if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin thi·∫øt b·ªã');

      const thietBiData = await response.json();
      openThietBiModal(thietBiData);
    } catch (error) {
      handleError('L·ªói khi t·∫£i th√¥ng tin thi·∫øt b·ªã:', error);
    }
  }

  async function deleteThietBi(thietBiMa, tenThietBi) {
    const result = await Swal.fire({
      title: 'X√°c nh·∫≠n x√≥a?',
      html: `B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a thi·∫øt b·ªã <strong>${tenThietBi}</strong>?`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#e53e3e',
      cancelButtonColor: '#667eea',
      confirmButtonText: 'X√≥a',
      cancelButtonText: 'H·ªßy'
    });

    if (result.isConfirmed) {
      try {
        const response = await fetch(`/api/thietbi/${thietBiMa}`, { method: 'DELETE' });
        await handleResponse(response);

        await showSuccess('Thi·∫øt b·ªã ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng');
        location.reload();
      } catch (error) {
        handleError('L·ªói khi x√≥a thi·∫øt b·ªã:', error);
      }
    }
  }

  // ===== BAO TRI MANAGEMENT =====
  function openBaoTriModal(baoTriData = null) {
    document.getElementById('baoTriModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';

    if (baoTriData) {
      populateBaoTriForm(baoTriData);
    } else {
      resetBaoTriForm();
    }
  }

  function closeBaoTriModal() {
    document.getElementById('baoTriModal').style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  function resetBaoTriForm() {
    document.getElementById('baoTriForm').reset();
    document.getElementById('baoTriId').value = '';
    document.getElementById('baoTriThoiGian').value = new Date().toISOString().slice(0, 16);
  }

  function populateBaoTriForm(data) {
    document.getElementById('baoTriId').value = data._id || '';
    document.getElementById('baoTriMaThietBi').value = data.MaThietBi || '';
    document.getElementById('baoTriChiPhi').value = data.ChiPhi || '';
    document.getElementById('baoTriThoiGian').value = data.ThoiGian ? new Date(data.ThoiGian).toISOString().slice(0, 16) : '';
    document.getElementById('baoTriMoTa').value = data.MoTa || '';
    document.getElementById('baoTriNhanVien').value = data.NhanVien || '';
    document.getElementById('baoTriKetQua').value = data.KetQua || '';
    updateThietBiInfo();
  }

  function updateThietBiInfo() {
    const selectedOption = document.querySelector('#baoTriMaThietBi option:checked');
    if (selectedOption && selectedOption.value) {
      document.getElementById('baoTriTenThietBi').value = selectedOption.getAttribute('data-tenthietbi') || '';
      document.getElementById('baoTriMaPhong').value = selectedOption.getAttribute('data-maphong') || '';
    }
  }

  async function saveBaoTri(event) {
    event.preventDefault();

    const formData = getBaoTriFormData();
    const validation = validateBaoTriForm(formData);

    if (!validation.isValid) {
      showError(validation.message);
      return;
    }

    try {
      await showLoading('ƒêang l∆∞u th√¥ng tin b·∫£o tr√¨...');

      const response = await fetch('/api/baotri', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });

      const result = await handleResponse(response);
      await showSuccess(result.message || 'Th√¥ng tin b·∫£o tr√¨ ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng!');

      setTimeout(() => {
        closeBaoTriModal();
        location.reload();
      }, 1500);

    } catch (error) {
      handleError('L·ªói khi l∆∞u b·∫£o tr√¨:', error);
    }
  }

  function getBaoTriFormData() {
    return {
      MaThietBi: document.getElementById('baoTriMaThietBi').value,
      ChiPhi: document.getElementById('baoTriChiPhi').value ? parseInt(document.getElementById('baoTriChiPhi').value) : 0,
      ThoiGian: document.getElementById('baoTriThoiGian').value,
      MoTa: document.getElementById('baoTriMoTa').value.trim(),
      NhanVien: document.getElementById('baoTriNhanVien').value.trim() || '',
      KetQua: document.getElementById('baoTriKetQua').value || ''
    };
  }

  function validateBaoTriForm(data) {
    if (!data.MaThietBi) {
      return { isValid: false, message: 'Vui l√≤ng ch·ªçn thi·∫øt b·ªã' };
    }
    if (!data.ChiPhi || data.ChiPhi <= 0) {
      return { isValid: false, message: 'Vui l√≤ng nh·∫≠p chi ph√≠ b·∫£o tr√¨ h·ª£p l·ªá' };
    }
    if (!data.MoTa) {
      return { isValid: false, message: 'Vui l√≤ng nh·∫≠p m√¥ t·∫£ b·∫£o tr√¨' };
    }
    return { isValid: true };
  }

  // ===== LICH SU BAO TRI =====
  async function viewBaoTriHistory(maThietBi) {
    try {
      const response = await fetch(`/api/baotri/thietbi/${maThietBi}`);
      const history = await response.json();

      if (!response.ok) throw new Error(history.error || 'Kh√¥ng th·ªÉ t·∫£i l·ªãch s·ª≠ b·∫£o tr√¨');

      currentThietBiHistory = history;
      showHistoryModal(maThietBi, history);

    } catch (error) {
      handleError('L·ªói khi l·∫•y l·ªãch s·ª≠ b·∫£o tr√¨:', error);
    }
  }

  function showHistoryModal(maThietBi, history) {
    document.getElementById('historyTitle').textContent = `L·ªãch s·ª≠ b·∫£o tr√¨ - ${maThietBi}`;
    renderBaoTriHistory(history);
    document.getElementById('historyModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }

  function renderBaoTriHistory(history) {
    const historyList = document.getElementById('historyList');

    if (!history || history.length === 0) {
      historyList.innerHTML = '<div class="empty-history">Ch∆∞a c√≥ l·ªãch s·ª≠ b·∫£o tr√¨</div>';
      return;
    }

    historyList.innerHTML = history.map(item => `
      <div class="history-item">
        <div class="history-header">
          <span class="history-date">${formatDateTime(item.ThoiGian)}</span>
          <span class="history-cost">${formatCurrency(item.ChiPhi)}</span>
        </div>
        <div class="history-details">
          <p class="history-desc">${item.MoTa}</p>
          ${item.NhanVien ? `<p class="history-staff"><strong>Nh√¢n vi√™n:</strong> ${item.NhanVien}</p>` : ''}
          ${item.KetQua ? `<p class="history-result"><strong>K·∫øt qu·∫£:</strong> ${item.KetQua}</p>` : ''}
        </div>
      </div>
    `).join('');
  }

  function closeHistoryModal() {
    document.getElementById('historyModal').style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  // ===== FILTER & SEARCH =====
  function filterThietBi() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const statusFilter = document.getElementById('statusFilter').value;
    const loaiFilter = document.getElementById('loaiFilter').value;

    filteredThietBis = allThietBis.filter(card => {
      const matchesSearch = matchesSearchCriteria(card, searchTerm);
      const matchesStatus = matchesFilterCriteria(card, 'data-tinhtrang', statusFilter);
      const matchesLoai = matchesFilterCriteria(card, 'data-loai', loaiFilter);
      const matchesRoom = matchesRoomCriteria(card);

      const shouldShow = matchesSearch && matchesStatus && matchesLoai && matchesRoom;
      card.style.display = shouldShow ? 'block' : 'none';
      return shouldShow;
    });

    updateDisplay();
  }

  function matchesSearchCriteria(card, searchTerm) {
    if (!searchTerm) return true;

    const tenthietbi = card.getAttribute('data-tenthietbi').toLowerCase();
    const matb = card.getAttribute('data-matb').toLowerCase();

    return tenthietbi.includes(searchTerm) || matb.includes(searchTerm);
  }

  function matchesFilterCriteria(card, attribute, filterValue) {
    if (!filterValue) return true;
    return card.getAttribute(attribute) === filterValue;
  }

  function matchesRoomCriteria(card) {
    const maphong = card.getAttribute('data-maphong');

    if (currentRoomFilter === 'all') return true;
    if (currentRoomFilter === 'other') {
      return !maphong || maphong === '' || maphong === 'Kh√°c';
    }
    return maphong === currentRoomFilter;
  }

  function updateDisplay() {
    calculateFilteredStatistics();
    toggleEmptyState(filteredThietBis.length === 0);
  }

  function calculateFilteredStatistics() {
    const totalThietBis = filteredThietBis.length;
    const countGood = filteredThietBis.filter(tb =>
      tb.getAttribute('data-tinhtrang') === 'T·ªët'
    ).length;

    const countMaintenance = filteredThietBis.filter(tb =>
      tb.getAttribute('data-tinhtrang') === 'ƒêang b·∫£o tr√¨'
    ).length;

    const countBroken = filteredThietBis.filter(tb =>
      tb.getAttribute('data-tinhtrang') === 'H·ªèng'
    ).length;

    // updateStatCard('#statTotal', totalThietBis);
    // updateStatCard('#statGood', countGood);
    // updateStatCard('#statMaintenance', countMaintenance);
    // updateStatCard('#statBroken', countBroken);
  }

  function clearFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('statusFilter').value = '';
    document.getElementById('loaiFilter').value = '';

    // Reset room filter to "T·∫•t c·∫£"
    currentRoomFilter = 'all';
    document.querySelectorAll('.room-nav-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    document.querySelector('.room-nav-btn[data-room="all"]').classList.add('active');

    allThietBis.forEach(card => {
      card.style.display = 'block';
    });

    filteredThietBis = [...allThietBis];
    calculateStatistics();
    toggleEmptyState(false);
  }

  function toggleEmptyState(show) {
    const emptyState = document.getElementById('emptyState');
    const grid = document.getElementById('thietBiGrid');

    if (!emptyState || !grid) return;

    if (show) {
      grid.style.display = 'none';
      emptyState.style.display = 'block';
    } else {
      grid.style.display = 'grid';
      emptyState.style.display = 'none';
    }
  }

  // ===== UTILITY FUNCTIONS =====
  function formatCurrency(amount) {
    if (typeof amount === 'string') {
      amount = parseFloat(amount) || 0;
    }
    return new Intl.NumberFormat('vi-VN', {
      style: 'currency',
      currency: 'VND'
    }).format(amount);
  }

  function formatDate(dateString) {
    if (!dateString) return 'N/A';
    const date = new Date(dateString);
    return date.toLocaleDateString('vi-VN');
  }

  function formatDateTime(dateString) {
    if (!dateString) return 'N/A';
    const date = new Date(dateString);
    return date.toLocaleString('vi-VN');
  }

  async function showLoading(message) {
     Swal.fire({
        title: message,
        html: 'Vui l√≤ng ch·ªù trong gi√¢y l√°t...',
        allowOutsideClick: false,
        allowEscapeKey: false,
        allowEnterKey: false,
        showConfirmButton: false,
        willOpen: () => {
            Swal.showLoading();
        }
    });
  }

  async function showSuccess(message) {
    await Swal.fire({
      icon: 'success',
      title: 'Th√†nh c√¥ng!',
      text: message,
      timer: 1500,
      showConfirmButton: false
    });
  }

  async function handleResponse(response) {
    const result = await response.json();
    if (!response.ok) {
      throw new Error(result.error || 'L·ªói server');
    }
    return result;
  }

  function handleError(context, error) {
    console.error(`‚ùå ${context}`, error);
    Swal.fire({
      icon: 'error',
      title: 'L·ªói!',
      text: error.message || 'ƒê√£ x·∫£y ra l·ªói kh√¥ng mong mu·ªën',
      confirmButtonColor: '#667eea'
    });
  }

  function showError(message) {
    Swal.fire({
      icon: 'warning',
      title: 'Thi·∫øu th√¥ng tin',
      text: message,
      confirmButtonColor: '#667eea'
    });
  }

  // ===== STATUS MANAGEMENT =====
  async function toggleStatus(thietBiMaTB, currentStatus) {
    const statusOrder = ['T·ªët', 'ƒêang b·∫£o tr√¨', 'C·∫ßn s·ª≠a ch·ªØa', 'H·ªèng'];
    const currentIndex = statusOrder.indexOf(currentStatus);
    const nextStatus = statusOrder[(currentIndex + 1) % statusOrder.length];

    console.log('=== TOGGLE STATUS DEBUG ===');
    console.log('thietBiMaTB:', thietBiMaTB);
    console.log('currentStatus:', currentStatus);
    console.log('nextStatus:', nextStatus);

    try {
      const response = await fetch(`/api/thietbi/${thietBiMaTB}/status`, {
        method: 'PUT',
        headers: { 
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ TinhTrang: nextStatus })
      });

      console.log('Response status:', response.status);
      
      // ƒê·ªçc response text tr∆∞·ªõc ƒë·ªÉ debug
      const responseText = await response.text();
      console.log('Response text:', responseText);
      
      let result;
      try {
        result = JSON.parse(responseText);
      } catch (e) {
        console.error('Failed to parse JSON:', e);
        throw new Error('Invalid JSON response from server');
      }

      if (response.ok) {
        await showSuccess(`ƒê√£ chuy·ªÉn tr·∫°ng th√°i th√†nh: ${nextStatus}`);
        location.reload();
      } else {
        throw new Error(result.error || `HTTP error! status: ${response.status}`);
      }
    } catch (error) {
      console.error('Toggle status error:', error);
      handleError('L·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i:', error);
    }
}


</script>






<style>
  /* ===== MAIN CONTENT STYLES ===== */
  .main-content {
    margin-left: 280px;
    transition: margin-left 0.3s ease;
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  }

  .sidebar-collapsed .main-content {
    margin-left: 80px;
  }

  /* ===== DASHBOARD STYLES ===== */
  .admin-dashboard {
    padding: 24px;
    min-height: 100vh;
  }

  .dashboard-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 28px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    color: white;
    position: relative;
    overflow: hidden;
  }

  .dashboard-header::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 200px;
    height: 200px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    transform: translate(30%, -30%);
  }

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
    position: relative;
    z-index: 1;
  }

  .header-title {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .title-icon {
    font-size: 3rem;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
  }

  .header-title h1 {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
  }

  .header-title p {
    margin: 8px 0 0 0;
    opacity: 0.9;
    font-size: 1.1rem;
  }

  .header-actions {
    display: flex;
    gap: 16px;
    align-items: center;
  }

  /* ===== BUTTON STYLES ===== */
  .btn-primary {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    color: white;
    border: none;
    padding: 14px 24px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
  }

  .btn-secondary {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.3);
    padding: 14px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .btn-secondary:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
  }

  /* ===== SEARCH AND FILTER ===== */
  .search-filter-bar {
    background: white;
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 28px;
    display: flex;
    gap: 24px;
    align-items: center;
    flex-wrap: wrap;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  .search-box {
    display: flex;
    align-items: center;
    background: #f8fafc;
    border-radius: 12px;
    padding: 12px 20px;
    flex: 1;
    min-width: 320px;
    border: 2px solid #e2e8f0;
    transition: all 0.3s ease;
  }

  .search-box:focus-within {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .search-box i {
    color: #64748b;
    margin-right: 12px;
    font-size: 1.1rem;
  }

  .search-box input {
    border: none;
    background: none;
    outline: none;
    flex: 1;
    padding: 8px 0;
    font-size: 1rem;
    color: #1e293b;
  }

  .search-box input::placeholder {
    color: #94a3b8;
  }

  .search-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    cursor: pointer;
    margin-left: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }

  .search-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
  }

  .filter-controls {
    display: flex;
    gap: 16px;
    align-items: center;
    flex-wrap: wrap;
  }

  .filter-select {
    padding: 12px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    background: white;
    color: #475569;
    min-width: 180px;
    font-size: 1rem;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .filter-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .clear-filters {
    background: #f1f5f9;
    border: 2px solid #e2e8f0;
    color: #64748b;
    padding: 12px 20px;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    font-weight: 500;
  }

  .clear-filters:hover {
    background: #e2e8f0;
    color: #475569;
    transform: translateY(-1px);
  }

  /* ===== STATS OVERVIEW ===== */
  .stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    margin-bottom: 32px;
  }

  .stat-card {
    background: white;
    border-radius: 20px;
    padding: 32px;
    display: flex;
    align-items: center;
    gap: 20px;
    box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 1px solid rgba(0, 0, 0, 0.03);
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea, #764ba2);
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 35px rgba(0, 0, 0, 0.12);
  }

  .stat-icon {
    width: 80px;
    height: 80px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }

  .stat-icon.total {
    background: linear-gradient(135deg, #fed7d7, #feb2b2);
    color: #c53030;
  }

  .stat-icon.active {
    background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
    color: #276749;
  }

  .stat-icon.reception {
    background: linear-gradient(135deg, #fed7d7, #feb2b2);
    color: #c53030;
  }

  .stat-icon.service {
    background: linear-gradient(135deg, #fefcbf, #faf089);
    color: #d69e2e;
  }

  .stat-info h3 {
    margin: 0;
    font-size: 2.5rem;
    color: #1e293b;
    font-weight: 700;
  }

  .stat-info p {
    margin: 8px 0 0 0;
    color: #64748b;
    font-size: 1.1rem;
    font-weight: 500;
  }

  /* ===== ROOM NAVIGATION ===== */
  .room-navigation {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    padding: 16px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    overflow-x: auto;
  }

  .room-nav-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    background: white;
    color: #475569;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
    font-weight: 500;
  }

  .room-nav-btn:hover {
    border-color: #667eea;
    color: #667eea;
    transform: translateY(-2px);
  }

  .room-nav-btn.active {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-color: #667eea;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }

  .room-nav-btn i {
    font-size: 1.1rem;
  }

  /* ===== ROOMS GRID ===== */
  .rooms-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 28px;
  }

  .room-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
    transition: all 0.4s ease;
    border: 1px solid rgba(0, 0, 0, 0.03);
    position: relative;
  }

  .room-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
  }

  .room-image {
    position: relative;
    height: 240px;
    overflow: hidden;
  }

  .room-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease;
  }

  .room-card:hover .room-image img {
    transform: scale(1.1);
  }

  .room-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.4s ease;
  }

  .room-card:hover .room-overlay {
    opacity: 1;
  }

  .room-actions {
    display: flex;
    gap: 16px;
  }

  .btn-edit,
  .btn-delete {
    width: 56px;
    height: 56px;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }

  .btn-edit {
    background: linear-gradient(135deg, #48bb78, #38a169);
    color: white;
  }

  .btn-delete {
    background: linear-gradient(135deg, #f56565, #e53e3e);
    color: white;
  }

  .btn-edit:hover,
  .btn-delete:hover {
    transform: scale(1.1) translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
  }

  .room-badge {
    position: absolute;
    top: 16px;
    left: 16px;
    padding: 8px 16px;
    border-radius: 25px;
    font-size: 0.85rem;
    font-weight: 700;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    z-index: 2;
  }

  .room-badge.Micro {
    background: linear-gradient(135deg, rgba(245, 101, 101, 0.95), rgba(229, 62, 62, 0.95));
    color: white;
  }

  .room-badge.Loa {
    background: linear-gradient(135deg, rgba(66, 153, 225, 0.95), rgba(49, 130, 206, 0.95));
    color: white;
  }

  .room-badge.Amply {
    background: linear-gradient(135deg, rgba(237, 137, 54, 0.95), rgba(217, 119, 6, 0.95));
    color: white;
  }

  .room-badge.M√†n-h√¨nh {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.95), rgba(118, 75, 162, 0.95));
    color: white;
  }

  .room-badge.ƒêi·ªÅu-h√≤a {
    background: linear-gradient(135deg, rgba(72, 187, 120, 0.95), rgba(56, 161, 105, 0.95));
    color: white;
  }

  .room-badge.B√†n-gh·∫ø {
    background: linear-gradient(135deg, rgba(159, 122, 234, 0.95), rgba(128, 90, 213, 0.95));
    color: white;
  }

  .room-badge.Kh√°c {
    background: linear-gradient(135deg, rgba(160, 174, 192, 0.95), rgba(113, 128, 150, 0.95));
    color: white;
  }

  .room-status {
    position: absolute;
    top: 16px;
    right: 16px;
    padding: 8px 16px;
    border-radius: 25px;
    font-size: 0.85rem;
    font-weight: 700;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    z-index: 2;
  }

  .room-status.active {
    background: linear-gradient(135deg, rgba(72, 187, 120, 0.95), rgba(56, 161, 105, 0.95));
    color: white;
  }

  .room-status.onleave {
    background: linear-gradient(135deg, rgba(237, 137, 54, 0.95), rgba(217, 119, 6, 0.95));
    color: white;
  }

  .room-status.inactive {
    background: linear-gradient(135deg, rgba(245, 101, 101, 0.95), rgba(229, 62, 62, 0.95));
    color: white;
  }

  .room-content {
    padding: 24px;
  }

  .room-title {
    margin: 0 0 8px 0;
    color: #1e293b;
    font-size: 1.4rem;
    font-weight: 700;
  }

  .room-code {
    margin: 0 0 4px 0;
    color: #64748b;
    font-size: 0.9rem;
    font-weight: 600;
  }

  .room-phong {
    margin: 0 0 16px 0;
    color: #667eea;
    font-size: 0.95rem;
    font-weight: 600;
  }

  .room-details {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
  }

  .detail-item {
    display: flex;
    align-items: center;
    gap: 12px;
    color: #475569;
    font-size: 1rem;
  }

  .detail-item i {
    color: #667eea;
    width: 20px;
    font-size: 1.1rem;
  }

  /* ===== MAINTENANCE HISTORY ===== */
  .maintenance-history {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #e2e8f0;
  }

  .maintenance-history h4 {
    margin: 0 0 8px 0;
    color: #1e293b;
    font-size: 1rem;
    font-weight: 600;
  }

  .maintenance-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
  }

  .maintenance-date {
    font-size: 0.85em;
    color: #718096;
  }

  .maintenance-cost {
    font-weight: bold;
    color: #2d3748;
    font-size: 0.9em;
  }

  .maintenance-desc {
    font-size: 0.8em;
    color: #718096;
    margin: 5px 0 0 0;
    line-height: 1.4;
  }

  .room-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 20px;
    border-top: 2px solid #f1f5f9;
  }

  .room-id {
    color: #94a3b8;
    font-size: 0.9rem;
    font-weight: 600;
  }

  .btn-status {
    background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #475569;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .btn-status:hover {
    background: linear-gradient(135deg, #e2e8f0, #cbd5e0);
    transform: rotate(15deg);
    color: #667eea;
  }

  /* ===== EMPTY STATE ===== */
  .empty-state {
    text-align: center;
    padding: 80px 40px;
    background: white;
    border-radius: 24px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
    border: 2px dashed #e2e8f0;
  }

  .empty-icon {
    font-size: 5rem;
    margin-bottom: 24px;
    opacity: 0.7;
  }

  .empty-state h3 {
    margin: 0 0 12px 0;
    color: #1e293b;
    font-size: 1.8rem;
    font-weight: 700;
  }

  .empty-state p {
    margin: 0 0 32px 0;
    color: #64748b;
    font-size: 1.2rem;
  }

  /* ===== MODAL STYLES ===== */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 20px;
    backdrop-filter: blur(8px);
  }

  .modal-container {
    background: white;
    border-radius: 24px;
    width: 100%;
    max-width: 900px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
    border: 1px solid rgba(255, 255, 255, 0.2);
    animation: modalSlideIn 0.4s ease-out;
  }

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-30px) scale(0.9);
    }

    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 28px;
    border-bottom: 2px solid #f1f5f9;
    background: linear-gradient(135deg, #f8fafc, #f1f5f9);
    border-radius: 24px 24px 0 0;
  }

  .modal-header h2 {
    margin: 0;
    color: #1e293b;
    font-size: 1.8rem;
    font-weight: 700;
  }

  .modal-close {
    background: #f1f5f9;
    border: none;
    font-size: 1.4rem;
    color: #64748b;
    cursor: pointer;
    padding: 8px;
    border-radius: 12px;
    transition: all 0.3s ease;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-close:hover {
    background: #e2e8f0;
    color: #475569;
    transform: rotate(90deg);
  }

  .modal-body {
    padding: 28px;
  }

  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group.full-width {
    grid-column: 1 / -1;
  }

  .form-group label {
    margin-bottom: 5px;
    color: #374151;
    font-weight: 600;
    font-size: 1rem;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    padding: 14px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 100px;
  }

  .image-preview {
    border: 3px dashed #e2e8f0;
    border-radius: 16px;
    padding: 50px 30px;
    text-align: center;
    color: #94a3b8;
    transition: all 0.3s ease;
    background: #f8fafc;
  }

  .image-preview:hover {
    border-color: #667eea;
    color: #667eea;
  }

  .image-preview img {
    max-width: 100%;
    max-height: 200px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }

  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 16px;
    padding: 28px;
    border-top: 2px solid #f1f5f9;
    background: #f8fafc;
    border-radius: 0 0 24px 24px;
  }

  /* ===== HISTORY MODAL STYLES ===== */
  .modal-container.large {
    max-width: 700px;
    width: 90%;
  }

  .history-list {
    max-height: 500px;
    overflow-y: auto;
    padding: 10px;
  }

  .history-item {
    padding: 15px;
    margin-bottom: 15px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    background: #f7fafc;
    transition: all 0.3s ease;
  }

  .history-item:hover {
    border-color: #667eea;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
  }

  .history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid #e2e8f0;
  }

  .history-date {
    font-weight: bold;
    color: #2d3748;
    font-size: 0.9em;
  }

  .history-cost {
    font-weight: bold;
    color: #2d3748;
    font-size: 1em;
  }

  .history-details p {
    margin: 5px 0;
    line-height: 1.5;
  }

  .history-staff,
  .history-result {
    font-size: 0.85em;
    color: #4a5568;
  }

  .history-staff strong,
  .history-result strong {
    color: #2d3748;
  }

  .empty-history {
    text-align: center;
    padding: 40px 20px;
    color: #718096;
    font-style: italic;
  }

  /* ===== EMPLOYEE AVATAR PLACEHOLDER ===== */
  .employee-avatar-placeholder.device {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    border-radius: 0;
  }

  .employee-avatar-placeholder.device i {
    font-size: 3rem;
    color: white;
  }

  /* Custom colors for device types v·ªõi t√™n class ƒë√∫ng */
  .employee-avatar-placeholder.device.Micro {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
  }

  .employee-avatar-placeholder.device.Loa {
    background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
  }

  .employee-avatar-placeholder.device.Amply {
    background: linear-gradient(135deg, #ffd93d 0%, #ff9a3d 100%);
  }

  .employee-avatar-placeholder.device.M√†n-h√¨nh {
    background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
  }

  .employee-avatar-placeholder.device.ƒêi·ªÅu-h√≤a {
    background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
  }

  .employee-avatar-placeholder.device.B√†n-gh·∫ø {
    background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
  }

  .employee-avatar-placeholder.device.Kh√°c {
    background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);
  }



  /* ===== RESPONSIVE STYLES ===== */
  @media (max-width: 1200px) {
    .main-content {
      margin-left: 280px;
    }
  }

  @media (max-width: 1024px) {
    .main-content {
      margin-left: 80px;
    }

    .rooms-grid {
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .main-content {
      margin-left: 0 !important;
      padding: 16px;
    }

    .admin-dashboard {
      padding: 16px;
    }

    .header-content {
      flex-direction: column;
      align-items: stretch;
      text-align: center;
    }

    .header-title {
      justify-content: center;
      text-align: center;
    }

    .search-filter-bar {
      flex-direction: column;
      align-items: stretch;
      padding: 20px;
    }

    .search-box {
      min-width: auto;
      margin-bottom: 16px;
    }

    .filter-controls {
      flex-direction: column;
      align-items: stretch;
    }

    .filter-select {
      min-width: auto;
    }

    .form-grid {
      grid-template-columns: 1fr;
    }

    .rooms-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .stats-overview {
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .modal-container {
      margin: 10px;
      max-width: none;
    }

    .room-navigation {
      flex-wrap: wrap;
    }
  }

  @media (max-width: 480px) {
    .admin-dashboard {
      padding: 12px;
    }

    .dashboard-header {
      padding: 20px;
    }

    .header-actions {
      flex-direction: column;
      width: 100%;
    }

    .btn-primary {
      width: 100%;
      justify-content: center;
    }

    .stat-card {
      padding: 24px;
    }

    .room-content {
      padding: 20px;
    }
  }

  /* ===== FIXES ===== */
  .swal2-container {
    z-index: 100000 !important;
  }

  .modal-overlay[style*="display: flex"] {
    display: flex !important;
  }

  .modal-overlay[style*="display: none"] {
    display: none !important;
  }

  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }
</style>