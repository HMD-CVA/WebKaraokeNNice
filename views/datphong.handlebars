<div class="main-content">
    <div class="admin-dashboard">
        <!-- Header Premium -->
        <div class="dashboard-header">
            <div class="header-content">
                <div class="header-title">
                    <div class="title-icon">üìÖ</div>
                    <div>
                        <h1>QU·∫¢N L√ù ƒê·∫∂T PH√íNG</h1>
                        <p>Theo d√µi v√† qu·∫£n l√Ω ƒë·∫∑t ph√≤ng karaoke</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn-primary" onclick="openDatPhongModal()">
                        <i class="fas fa-plus"></i>
                        <span>T·∫°o ƒë·∫∑t ph√≤ng</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Search and Filter Bar -->
        <div class="search-filter-bar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm ƒë·∫∑t ph√≤ng..." onkeyup="filterDatPhong()">
                <button class="search-btn" onclick="filterDatPhong()">T√¨m ki·∫øm</button>
            </div>
            <div class="filter-controls">
                <select class="filter-select" id="statusFilter" onchange="filterDatPhong()">
                    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="S·∫Øp t·ªõi">S·∫Øp t·ªõi</option>
                    <option value="Ho√†n th√†nh">Ho√†n th√†nh</option>
                    <option value="ƒê√£ h·ªßy">ƒê√£ h·ªßy</option>
                </select>
                <input type="date" class="filter-select" id="dateFromFilter" onchange="filterDatPhong()"
                    placeholder="T·ª´ ng√†y">
                <input type="date" class="filter-select" id="dateToFilter" onchange="filterDatPhong()"
                    placeholder="ƒê·∫øn ng√†y">
                <select class="filter-select" id="sortFilter" onchange="filterDatPhong()">
                    <option value="newest">M·ªõi nh·∫•t</option>
                    <option value="oldest">C≈© nh·∫•t</option>
                </select>
                <button class="clear-filters" onclick="clearFilters()">
                    <i class="fas fa-times"></i>
                    X√≥a l·ªçc
                </button>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-icon total">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-info">
                    <h3 id="statTotal">0</h3>
                    <p>T·ªïng ƒë·∫∑t ph√≤ng</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon active">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-info">
                    <h3 id="statActive">0</h3>
                    <p>S·∫Øp t·ªõi</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon service">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="statCompleted">0</h3>
                    <p>Ho√†n th√†nh</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon technical">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="statCancelled">0</h3>
                    <p>ƒê√£ h·ªßy</p>
                </div>
            </div>
        </div>

        <!-- DatPhong Table -->
        <div class="table-container" id="datPhongTable">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 120px;">M√£ ƒë·∫∑t ph√≤ng</th>
                        <th style="width: 100px;">Ph√≤ng</th>
                        <th style="width: 150px;">Kh√°ch h√†ng</th>
                        <th style="width: 130px;">S·ªë ƒëi·ªán tho·∫°i</th>
                        <th style="width: 120px;">Ng√†y t·∫°o</th>
                        <th style="width: 140px;">B·∫Øt ƒë·∫ßu</th>
                        <th style="width: 130px;">Tr·∫°ng th√°i</th>
                        <th style="width: 200px;">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="datPhongTableBody">
                    {{#each datPhongKH}}
                    <tr data-id="{{this._id}}" 
                        data-madp="{{this.MaDatPhong}}"
                        data-makh="{{this.MaKH}}"
                        data-maphong="{{this.MaPhong}}" 
                        data-status="{{this.TrangThai}}"
                        data-date="{{formatDate this.createdAt}}" 
                        data-start="{{formatDateTime this.ThoiGianBatDau}}"
                        data-customer="{{#if this.ChiTiet.[0]}}{{this.ChiTiet.[0].TenKH}}{{else}}Kh√¥ng c√≥ th√¥ng tin{{/if}}">
                        <td><strong class="booking-code">{{this.MaDatPhong}}</strong></td>
                        <td><span class="room-badge">{{this.MaPhong}}</span></td>
                        <td>
                            {{#if this.ChiTiet.[0]}}
                                {{this.ChiTiet.[0].TenKH}}
                            {{else}}
                                <span class="text-muted">Kh√¥ng c√≥ th√¥ng tin</span>
                            {{/if}}
                        </td>
                        <td>
                            {{#if this.ChiTiet.[0]}}
                                {{this.ChiTiet.[0].SDT}}
                            {{else}}
                                <span class="text-muted">--</span>
                            {{/if}}
                        </td>
                        <td>{{formatDate this.createdAt}}</td>
                        <td>{{formatTime this.ThoiGianBatDau}}</td>
                        <td>
                            <span class="status-badge {{#if (eq this.TrangThai 'S·∫Øp t·ªõi')}}status-warning{{else if (eq this.TrangThai 'ƒê√£ ƒë·∫∑t')}}status-warning{{else if (eq this.TrangThai 'Ho√†n th√†nh')}}status-success{{else if (eq this.TrangThai 'ƒê√£ h·ªßy')}}status-danger{{else}}status-info{{/if}}">
                                {{#if (eq this.TrangThai 'S·∫Øp t·ªõi')}}‚è∞ S·∫Øp t·ªõi{{/if}}
                                {{#if (eq this.TrangThai 'ƒê√£ ƒë·∫∑t')}}‚è≥ ƒê√£ ƒë·∫∑t{{/if}}
                                {{#if (eq this.TrangThai 'Ho√†n th√†nh')}}‚úÖ Ho√†n th√†nh{{/if}}
                                {{#if (eq this.TrangThai 'ƒê√£ h·ªßy')}}‚ùå ƒê√£ h·ªßy{{/if}}
                            </span>
                        </td>
                        <td class="table-actions">
                            <div class="action-buttons">
                                <button class="btn-table-action btn-detail" onclick="viewDatPhongDetail('{{this.MaDatPhong}}')" title="Xem chi ti·∫øt">
                                    <i class="fas fa-eye"></i>
                                </button>
                                
                                {{#if (eq this.TrangThai "ƒê√£ ƒë·∫∑t")}}
                                    <button class="btn-table-action btn-checkin" onclick="checkInDatPhong('{{this.MaDatPhong}}')" title="Check-in">
                                        <i class="fas fa-sign-in-alt"></i>
                                    </button>
                                    <button class="btn-table-action btn-edit" onclick="handleEditClick(this)" title="S·ª≠a">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-table-action btn-cancel" onclick="cancelDatPhong('{{this.MaDatPhong}}')" title="H·ªßy ƒë·∫∑t ph√≤ng">
                                        <i class="fas fa-ban"></i>
                                    </button>
                                {{else if (eq this.TrangThai "ƒê√£ h·ªßy")}}
                                    <!-- Ch·ªâ hi·ªán n√∫t xem chi ti·∫øt -->
                                {{else if (eq this.TrangThai "Ho√†n th√†nh")}}
                                    <!-- Ch·ªâ hi·ªán n√∫t xem chi ti·∫øt -->
                                {{/if}}
                            </div>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState"
            style="{{#if datPhongKH.length}}display: none;{{else}}display: block;{{/if}}">
            <div class="empty-icon">üìÖ</div>
            <h3>Kh√¥ng t√¨m th·∫•y ƒë·∫∑t ph√≤ng</h3>
            <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·∫°o ƒë·∫∑t ph√≤ng m·ªõi</p>
            <button class="btn-primary" onclick="openDatPhongModal()">
                <i class="fas fa-plus"></i>
                T·∫°o ƒë·∫∑t ph√≤ng ƒë·∫ßu ti√™n
            </button>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" id="paginationContainer" style="{{#if datPhongKH.length}}display: flex;{{else}}display: none;{{/if}}">
            <div class="pagination-info">
                Hi·ªÉn th·ªã <span id="startIndex">1</span> - <span id="endIndex">10</span> trong t·ªïng s·ªë <span id="totalBookings">{{datPhongKH.length}}</span> ƒë·∫∑t ph√≤ng
            </div>
            <div class="pagination-controls">
                <button class="pagination-btn" id="prevPageBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="page-numbers" id="pageNumbers">
                    <!-- Page numbers will be generated by JavaScript -->
                </div>
                <button class="pagination-btn" id="nextPageBtn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- DatPhong Modal -->
    <div class="modal-overlay" id="datPhongModal" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="modalTitle">T·∫°o ƒë·∫∑t ph√≤ng m·ªõi</h2>
                <button class="modal-close" onclick="closeDatPhongModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <form id="datPhongForm" onsubmit="saveDatPhong(event)">
                    <input type="hidden" id="datPhongId">
                    <input type="hidden" id="datPhongMaDP">
                    <input type="hidden" id="maKH">

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="sdtKH">
                                <i class="fas fa-phone"></i>
                                S·ªë ƒëi·ªán tho·∫°i *
                            </label>
                            <input type="tel" id="sdtKH" required placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i (10 s·ªë)" maxlength="10" pattern="[0-9]{10}">
                            <small style="color: #64748b; font-size: 0.85rem; margin-top: 4px; display: block;">
                                <i class="fas fa-info-circle"></i> Nh·∫≠p 10 s·ªë ƒë·ªÉ t·ª± ƒë·ªông t√¨m kh√°ch h√†ng
                            </small>
                        </div>

                        <div class="form-group" id="tenKHGroup" style="display: none;">
                            <label for="tenKH">
                                <i class="fas fa-user"></i>
                                T√™n kh√°ch h√†ng *
                            </label>
                            <input type="text" id="tenKH" required placeholder="T√™n kh√°ch h√†ng s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn">
                            <small style="color: #64748b; font-size: 0.85rem; margin-top: 4px; display: block;">
                                <i class="fas fa-info-circle"></i> T·ª± ƒë·ªông ƒëi·ªÅn n·∫øu ƒë√£ c√≥ trong h·ªá th·ªëng
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="phongSelect">Ph√≤ng *</label>
                            <select id="phongSelect" required>
                                <option value="">Ch·ªçn ph√≤ng</option>
                                {{#each phongs}}
                                <option value="{{this.MaPhong}}" data-loaiphong="{{this.LoaiPhong}}"
                                    data-giaphong="{{this.GiaPhong}}" data-succhua="{{this.SucChua}}">
                                    Ph√≤ng {{this.MaPhong}} - {{this.LoaiPhong}} (S·ª©c ch·ª©a: {{this.SucChua}} ng∆∞·ªùi)
                                </option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="maPhong">M√£ ph√≤ng</label>
                            <input type="text" id="maPhong" readonly>
                        </div>

                        <div class="form-group">
                            <label for="loaiPhong">Lo·∫°i ph√≤ng</label>
                            <input type="text" id="loaiPhong" readonly>
                        </div>

                        <div class="form-group">
                            <label for="giaPhong">Gi√° ph√≤ng</label>
                            <input type="text" id="giaPhong" readonly style="background: #e7f5ff; border: 2px solid #4299e1; font-weight: 600; color: #2c5282;">
                            <small id="giaPhongWarning" style="color: #dc3545; display: none; margin-top: 4px;"></small>
                        </div>

                        <div class="form-group">
                            <label for="soNguoi">S·ªë ng∆∞·ªùi *</label>
                            <input type="number" id="soNguoi" min="1" max="50" required placeholder="Nh·∫≠p s·ªë ng∆∞·ªùi" oninput="validateSoNguoi()">
                            <small id="soNguoiWarning" style="color: #dc3545; display: none; margin-top: 4px;"></small>
                        </div>

                        <div class="form-group">
                            <label for="thoiGianBatDau">Th·ªùi gian b·∫Øt ƒë·∫ßu *</label>
                            <input type="datetime-local" id="thoiGianBatDau" required onchange="updateGiaPhong()">
                        </div>

                        <div class="form-group full-width">
                            <label for="ghiChu">Ghi ch√∫</label>
                            <textarea id="ghiChu" rows="3" placeholder="Ghi ch√∫ v·ªÅ ƒë·∫∑t ph√≤ng..."></textarea>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" type="button" onclick="closeDatPhongModal()">
                    <i class="fas fa-times"></i>
                    H·ªßy
                </button>
                <button class="btn-primary" type="submit" form="datPhongForm" id="submitBtn" disabled>
                    <i class="fas fa-check-double"></i>
                    L∆∞u ƒë·∫∑t ph√≤ng
                </button>
            </div>
        </div>
    </div>

    <!-- Chi ti·∫øt ƒë·∫∑t ph√≤ng Modal -->
    <div class="modal-overlay" id="detailModal" style="display: none;">
        <div class="modal-container invoice-modal">
            <!-- HEADER M·ªöI - ƒê√É ƒê∆Ø·ª¢C S·∫ÆP X·∫æP L·∫†I -->
            <div class="modal-header invoice-company-header">
                <!-- H√†ng 1: Logo c√¥ng ty v√† n√∫t h√†nh ƒë·ªông -->
                <div class="header-top-row">
                    <div class="company-logo">
                        <div class="logo-placeholder">
                            <i class="fas fa-microphone-alt"></i>
                        </div>
                        <div class="company-info">
                            <h1>KARAOKE NNICE</h1>
                            <p>113 Phan X√≠ch Long, Ph∆∞·ªùng 2, Qu·∫≠n Ph√∫ Nhu·∫≠n, TP. H·ªì Ch√≠ Minh, Vi·ªát Nam</p>
                            <p>(028) 35 170 046</p>
                        </div>
                    </div>
                    <div class="header-actions" id="headerActions">
                        <!-- N√∫t h√†nh ƒë·ªông s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JS -->
                    </div>
                </div>

                <!-- H√†ng 2: Ti√™u ƒë·ªÅ -->
                <div class="header-title-row">
                    <h2>CHI TI·∫æT ƒê·∫∂T PH√íNG</h2>
                </div>

                <!-- H√†ng 3: Th√¥ng tin ƒë·∫∑t ph√≤ng -->
                <div class="header-meta-row">
                    <div class="meta-item">
                        <span class="label">Ng√†y ƒë·∫∑t:</span>
                        <span class="value" id="modal-booking-date"></span>
                    </div>
                    <div class="meta-item">
                        <span class="label">M√£ ƒë·∫∑t ph√≤ng:</span>
                        <span class="value" id="modal-booking-number"></span>
                    </div>
                    <div class="meta-item">
                        <span class="label">Tr·∫°ng th√°i:</span>
                        <span class="value status-badge" id="modal-booking-status"></span>
                    </div>
                </div>
            </div>

            <div class="modal-body" id="detailContent">
                <!-- N·ªôi dung chi ti·∫øt s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JS -->
            </div>

            <!-- TH√äM FOOTER V·ªöI N√öT ƒê√ìNG -->
            <div class="modal-footer">
                <button class="btn-secondary" type="button" onclick="closeDetailModal()">ƒê√≥ng</button>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    // ===== CONFIGURATION & STATE =====
    let allDatPhongs = [];
    let filteredDatPhongs = [];

    // ===== STATISTICS CALCULATION =====
    function calculateStatistics() {
        const datPhongs = allDatPhongs;

        const totalDatPhongs = datPhongs.length;
        // C·∫≠p nh·∫≠t: T√≠nh ƒë∆°n "S·∫Øp t·ªõi" (bao g·ªìm c·∫£ "ƒê√£ ƒë·∫∑t")
        const countActive = datPhongs.filter(dp => {
            const status = dp.getAttribute('data-status');
            return status === 'S·∫Øp t·ªõi' || status === 'ƒê√£ ƒë·∫∑t';
        }).length;
        const countUpcoming = countActive; // Gi·ªØ cho t∆∞∆°ng th√≠ch
        // C·∫≠p nh·∫≠t: T√≠nh ƒë∆°n "Ho√†n th√†nh" (ƒë√£ check-in v√† t·∫°o h√≥a ƒë∆°n)
        const countCompleted = datPhongs.filter(dp => dp.getAttribute('data-status') === 'Ho√†n th√†nh').length;
        const countCancelled = datPhongs.filter(dp => dp.getAttribute('data-status') === 'ƒê√£ h·ªßy').length;

        updateStatCard('#statTotal', totalDatPhongs);
        updateStatCard('#statActive', countActive);
        updateStatCard('#statUpcoming', countUpcoming);
        updateStatCard('#statCompleted', countCompleted);
        updateStatCard('#statCancelled', countCancelled);
    }

    function updateStatCard(selector, value) {
        const element = document.querySelector(selector);
        if (element) {
            element.textContent = value;
        }
    }

    // ===== FORMAT FUNCTIONS =====
    function formatDate(dateString) {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        return date.toLocaleDateString('vi-VN');
    }

    function formatTime(dateString) {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        return date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
    }

    function formatDateTime(dateString) {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        return date.toLocaleString('vi-VN');
    }

    // ===== DAT PHONG MANAGEMENT =====
    function openDatPhongModal(datPhongData = null) {
        document.getElementById('modalTitle').textContent = datPhongData ? 'Ch·ªânh s·ª≠a ƒë·∫∑t ph√≤ng' : 'T·∫°o ƒë·∫∑t ph√≤ng m·ªõi';
        document.getElementById('datPhongModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';

        if (datPhongData) {
            console.log('üìù ƒê·ªï d·ªØ li·ªáu v√†o modal edit:', datPhongData);
            
            // ƒêi·ªÅn th√¥ng tin ƒë·∫∑t ph√≤ng
            document.getElementById('datPhongId').value = datPhongData._id || '';
            document.getElementById('datPhongMaDP').value = datPhongData.MaDatPhong || '';
            
            // Hi·ªÉn th·ªã th√¥ng tin kh√°ch h√†ng (readonly)
            if (datPhongData.KhachHang) {
                document.getElementById('tenKH').value = datPhongData.KhachHang.TenKH || '';
                document.getElementById('sdtKH').value = datPhongData.KhachHang.SDT || '';
            }
            
            // Set gi√° tr·ªã cho select ph√≤ng (ch∆∞a g·ªçi loadPhongInfo ngay ƒë·ªÉ ƒë·∫£m b·∫£o c√≥ th·ªùi gian)
            const phongSelect = document.getElementById('phongSelect');
            if (phongSelect) {
                phongSelect.value = datPhongData.MaPhong || '';
            }
            
            // ƒêi·ªÅn s·ªë ng∆∞·ªùi v√† ghi ch√∫
            document.getElementById('soNguoi').value = datPhongData.SoNguoi || 1;
            document.getElementById('ghiChu').value = datPhongData.GhiChu || '';

            // ƒêi·ªÅn th·ªùi gian b·∫Øt ƒë·∫ßu tr∆∞·ªõc, ƒë·ªÉ khi load ph√≤ng c√≥ th·ªÉ t√≠nh gi√° ngay
            const startTime = formatDateTimeLocal(datPhongData.ThoiGianBatDau);
            console.log('‚è∞ Th·ªùi gian b·∫Øt ƒë·∫ßu:', startTime);
            document.getElementById('thoiGianBatDau').value = startTime;

            // Sau khi ƒë√£ c√≥ ph√≤ng + th·ªùi gian, load th√¥ng tin ph√≤ng v√† t√≠nh gi√°
            if (phongSelect) {
                loadPhongInfo();
                // ƒê·∫£m b·∫£o t√≠nh l·∫°i gi√° n·∫øu s·ª± ki·ªán change kh√¥ng t·ª± k√≠ch ho·∫°t
                updateGiaPhong();
            }
            
            // Validate t·∫•t c·∫£ tr∆∞·ªùng sau khi load xong
            setTimeout(() => {
                validateAllFields();
            }, 500);
        } else {
            resetDatPhongForm();
        }
    }

    function closeDatPhongModal() {
        const modal = document.getElementById('datPhongModal');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // X√≥a backdrop-filter v√† ƒë·∫£m b·∫£o modal bi·∫øn m·∫•t ho√†n to√†n
        modal.style.opacity = '0';
        setTimeout(() => {
            modal.style.opacity = '1';
        }, 100);
        
        resetDatPhongForm();
        currentRoomPriceTable = null;
        
        // Reset n√∫t submit
        const submitBtn = document.getElementById('submitBtn');
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.5';
            submitBtn.style.cursor = 'not-allowed';
        }
    }

    function handleEditClick(button) {
        const row = button.closest('tr');
        const maDatPhong = row.getAttribute('data-madp');
        console.log('üîß Handle edit click, maDatPhong:', maDatPhong);
        editDatPhong(maDatPhong);
    }

    async function editDatPhong(maDatPhong) {
        try {
            console.log('üîß Edit ƒë·∫∑t ph√≤ng v·ªõi m√£:', maDatPhong);
            
            if (!maDatPhong || maDatPhong === 'undefined') {
                throw new Error('M√£ ƒë·∫∑t ph√≤ng kh√¥ng h·ª£p l·ªá');
            }
            
            const response = await fetch(`/api/datphong/${maDatPhong}`);
            if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin ƒë·∫∑t ph√≤ng');
            
            const datPhongData = await response.json();
            console.log('üìä D·ªØ li·ªáu ƒë·∫∑t ph√≤ng:', datPhongData);
            
            openDatPhongModal(datPhongData);
        } catch (error) {
            console.error('‚ùå L·ªói khi t·∫£i ƒë·∫∑t ph√≤ng:', error);
            Swal.fire({
                icon: 'error',
                title: 'L·ªói!',
                text: error.message || 'Kh√¥ng th·ªÉ t·∫£i th√¥ng tin ƒë·∫∑t ph√≤ng',
                confirmButtonColor: '#667eea'
            });
        }
    }

    async function cancelDatPhong(maDatPhong) {
        const result = await Swal.fire({
            title: 'X√°c nh·∫≠n h·ªßy ƒë·∫∑t ph√≤ng?',
            html: `
                <div style="text-align: left; padding: 10px;">
                    <p style="margin-bottom: 10px;">üìã <strong>M√£ ƒë·∫∑t ph√≤ng:</strong> ${maDatPhong}</p>
                    <p style="margin-bottom: 10px; color: #e53e3e;">‚ö†Ô∏è <strong>Khi h·ªßy ƒë·∫∑t ph√≤ng:</strong></p>
                    <ul style="list-style: none; padding-left: 0; color: #718096;">
                        <li>‚Ä¢ ƒê∆°n ƒë·∫∑t ph√≤ng chuy·ªÉn sang tr·∫°ng th√°i "ƒê√£ h·ªßy"</li>
                        <li>‚Ä¢ Ph√≤ng ƒë∆∞·ª£c kh√¥i ph·ª•c v·ªÅ tr·∫°ng th√°i "Tr·ªëng"</li>
                        <li>‚Ä¢ Kh√¥ng th·ªÉ ho√†n t√°c thao t√°c n√†y</li>
                    </ul>
                </div>
            `,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#e53e3e',
            cancelButtonColor: '#667eea',
            confirmButtonText: 'H·ªßy ƒë·∫∑t ph√≤ng',
            cancelButtonText: 'Kh√¥ng, gi·ªØ l·∫°i'
        });

        if (result.isConfirmed) {
            try {
                Swal.fire({
                    title: 'ƒêang h·ªßy ƒë·∫∑t ph√≤ng...',
                    text: 'Vui l√≤ng ch·ªù trong gi√¢y l√°t',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                const response = await fetch(`/api/datphong/${maDatPhong}/huy`, { 
                    method: 'PUT'
                });
                
                const responseData = await response.json();
                
                if (!response.ok) {
                    throw new Error(responseData.message || 'L·ªói khi h·ªßy ƒë·∫∑t ph√≤ng');
                }

                Swal.fire({
                    icon: 'success',
                    title: 'ƒê√£ h·ªßy ƒë·∫∑t ph√≤ng!',
                    html: `
                        <div style="text-align: left;">
                            <p>‚úÖ ƒê∆°n ƒë·∫∑t ph√≤ng <strong>${maDatPhong}</strong> ƒë√£ ƒë∆∞·ª£c h·ªßy</p>
                            ${responseData.data?.maPhong ? `<p>üè† Ph√≤ng <strong>${responseData.data.maPhong}</strong> ƒë√£ ƒë∆∞·ª£c kh√¥i ph·ª•c v·ªÅ tr·∫°ng th√°i "Tr·ªëng"</p>` : ''}
                        </div>
                    `,
                    timer: 2000,
                    showConfirmButton: false
                });

                setTimeout(() => location.reload(), 2000);
            } catch (error) {
                console.error('‚ùå L·ªói khi h·ªßy ƒë·∫∑t ph√≤ng:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'L·ªói!',
                    text: error.message || 'Kh√¥ng th·ªÉ h·ªßy ƒë·∫∑t ph√≤ng',
                    confirmButtonColor: '#667eea'
                });
            }
        }
    }

    async function viewDatPhongDetail(maDatPhong) {
        try {
            const response = await fetch(`/api/datphong/${maDatPhong}`);
            if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin ƒë·∫∑t ph√≤ng');
            
            const result = await response.json();
            const datPhong = result.data;
            
            // Hi·ªÉn th·ªã modal chi ti·∫øt (n·∫øu c√≥)
            Swal.fire({
                title: `ƒê·∫∑t ph√≤ng: ${datPhong.MaDatPhong}`,
                html: `
                    <div style="text-align: left;">
                        <p><strong>Ph√≤ng:</strong> ${datPhong.MaPhong}</p>
                        <p><strong>Kh√°ch h√†ng:</strong> ${datPhong.ChiTiet?.[0]?.TenKH || 'N/A'}</p>
                        <p><strong>SƒêT:</strong> ${datPhong.ChiTiet?.[0]?.SDT || 'N/A'}</p>
                        <p><strong>B·∫Øt ƒë·∫ßu:</strong> ${new Date(datPhong.ThoiGianBatDau).toLocaleString('vi-VN')}</p>
                        <p><strong>Tr·∫°ng th√°i:</strong> ${datPhong.TrangThai}</p>
                        ${datPhong.GhiChu ? `<p><strong>Ghi ch√∫:</strong> ${datPhong.GhiChu}</p>` : ''}
                    </div>
                `,
                confirmButtonColor: '#667eea',
                confirmButtonText: 'ƒê√≥ng'
            });
        } catch (error) {
            console.error('‚ùå L·ªói khi t·∫£i chi ti·∫øt:', error);
            Swal.fire({
                icon: 'error',
                title: 'L·ªói!',
                text: 'Kh√¥ng th·ªÉ t·∫£i th√¥ng tin ƒë·∫∑t ph√≤ng',
                confirmButtonColor: '#667eea'
            });
        }
    }

    function resetDatPhongForm() {
        document.getElementById('datPhongForm').reset();
        document.getElementById('datPhongId').value = '';
        document.getElementById('datPhongMaDP').value = '';
        document.getElementById('maKH').value = '';
        
        // ·∫®n field t√™n kh√°ch h√†ng
        const tenKHGroup = document.getElementById('tenKHGroup');
        if (tenKHGroup) {
            tenKHGroup.style.display = 'none';
        }
        
        // Reset readonly state
        const tenKHInput = document.getElementById('tenKH');
        if (tenKHInput) {
            tenKHInput.readOnly = false;
            tenKHInput.style.background = '#fff';
            tenKHInput.style.cursor = 'text';
        }
    }

    function validateSoNguoi() {
        const soNguoiInput = document.getElementById('soNguoi');
        const warningEl = document.getElementById('soNguoiWarning');
        const selectedOption = document.querySelector('#phongSelect option:checked');
        
        if (!selectedOption || !selectedOption.value) {
            warningEl.style.display = 'none';
            validateAllFields();
            return true;
        }
        
        const soNguoi = parseInt(soNguoiInput.value);
        const sucChua = parseInt(selectedOption.getAttribute('data-succhua')) || 0;
        
        if (soNguoi > sucChua) {
            warningEl.textContent = `‚ö†Ô∏è S·ªë ng∆∞·ªùi v∆∞·ª£t qu√° s·ª©c ch·ª©a ph√≤ng (T·ªëi ƒëa: ${sucChua} ng∆∞·ªùi)`;
            warningEl.style.display = 'block';
            soNguoiInput.style.borderColor = '#dc3545';
            validateAllFields();
            return false;
        } else {
            warningEl.style.display = 'none';
            soNguoiInput.style.borderColor = '';
            validateAllFields();
            return true;
        }
    }

    function loadPhongInfo() {
        const selectedOption = document.querySelector('#phongSelect option:checked');
        if (selectedOption && selectedOption.value) {
            document.getElementById('maPhong').value = selectedOption.value || '';
            document.getElementById('loaiPhong').value = selectedOption.getAttribute('data-loaiphong') || '';
            const sucChua = selectedOption.getAttribute('data-succhua') || 0;
            
            // Update max attribute c·ªßa input s·ªë ng∆∞·ªùi
            const soNguoiInput = document.getElementById('soNguoi');
            if (sucChua) {
                soNguoiInput.setAttribute('max', sucChua);
            }
            
            // Reset b·∫£ng gi√° khi ƒë·ªïi ph√≤ng
            currentRoomPriceTable = null;
            
            // Update gi√° ph√≤ng theo th·ªùi gian
            updateGiaPhong();
            
            // Validate l·∫°i s·ªë ng∆∞·ªùi n·∫øu ƒë√£ nh·∫≠p
            validateSoNguoi();
            
            // Validate t·∫•t c·∫£ tr∆∞·ªùng
            validateAllFields();
        }
    }

    // L∆∞u b·∫£ng gi√° hi·ªán t·∫°i c·ªßa ph√≤ng
    let currentRoomPriceTable = null;

    // Load b·∫£ng gi√° ph√≤ng theo logic c·ªßa home.js
    async function loadRoomPriceTable(maPhong) {
        try {
            console.log(`üìä ƒêang t·∫£i b·∫£ng gi√° cho ph√≤ng: ${maPhong}`);
            
            const response = await fetch(`/api/hoadon/banggia/${maPhong}`);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const result = await response.json();
            let priceData = null;

            if (Array.isArray(result)) {
                priceData = result;
            } else if (result.success && result.data) {
                priceData = result.data;
            } else {
                throw new Error('ƒê·ªãnh d·∫°ng response kh√¥ng h·ª£p l·ªá');
            }

            if (!priceData || !Array.isArray(priceData)) {
                throw new Error('D·ªØ li·ªáu b·∫£ng gi√° kh√¥ng h·ª£p l·ªá');
            }

            // Chu·∫©n h√≥a d·ªØ li·ªáu
            currentRoomPriceTable = priceData.map(item => ({
                KhungGio: item.KhungGio || item.khungGio,
                GiaTien: parseInt(item.GiaTien || item.giaTien || 0)
            })).filter(item => item.KhungGio && item.GiaTien);

            console.log(`‚úÖ ƒê√£ t·∫£i ${currentRoomPriceTable.length} m·ª•c gi√°:`, currentRoomPriceTable);
            return currentRoomPriceTable;

        } catch (error) {
            console.error('‚ùå L·ªói khi t·∫£i b·∫£ng gi√°:', error);
            currentRoomPriceTable = null;
            throw error;
        }
    }

    // T√≠nh gi√° ph√≤ng theo th·ªùi gian (logic t·ª´ home.js)
    function calculateRoomPriceByTime(thoiGianBatDau, bangGia) {
        if (!thoiGianBatDau || !bangGia || !Array.isArray(bangGia)) {
            console.warn('‚ùå Kh√¥ng c√≥ th·ªùi gian b·∫Øt ƒë·∫ßu ho·∫∑c b·∫£ng gi√°');
            return { price: 0, isValid: false };
        }

        const thoiGian = new Date(thoiGianBatDau);
        const gioHienTai = thoiGian.getHours();
        const phutHienTai = thoiGian.getMinutes();
        const thoiGianHienTai = gioHienTai * 60 + phutHienTai;

        console.log(`üïí Th·ªùi gian b·∫Øt ƒë·∫ßu: ${gioHienTai}:${phutHienTai.toString().padStart(2, '0')}`);

        let foundPrice = 0;
        let foundTimeSlot = '';
        let hasValidTimeSlot = false;

        for (const gia of bangGia) {
            if (!gia.KhungGio) continue;

            const [batDauStr, ketThucStr] = gia.KhungGio.split('-');
            if (!batDauStr || !ketThucStr) continue;

            const [gioBatDau, phutBatDau] = batDauStr.split(':').map(Number);
            const [gioKetThuc, phutKetThuc] = ketThucStr.split(':').map(Number);
            
            let thoiGianBatDauPhut = gioBatDau * 60 + phutBatDau;
            let thoiGianKetThucPhut = gioKetThuc * 60 + phutKetThuc;

            let isMatch = false;
            const isQuaNgay = thoiGianBatDauPhut >= thoiGianKetThucPhut;

            if (isQuaNgay) {
                thoiGianKetThucPhut += 1440;
                
                const thoiGianHienTaiExtended = thoiGianHienTai < thoiGianBatDauPhut 
                    ? thoiGianHienTai + 1440 
                    : thoiGianHienTai;
                
                isMatch = (thoiGianHienTaiExtended >= thoiGianBatDauPhut && 
                          thoiGianHienTaiExtended < thoiGianKetThucPhut);
                
            } else {
                isMatch = (thoiGianHienTai >= thoiGianBatDauPhut && 
                          thoiGianHienTai < thoiGianKetThucPhut);
            }

            if (isMatch) {
                foundPrice = gia.GiaTien || 0;
                foundTimeSlot = gia.KhungGio;
                hasValidTimeSlot = true;
                break;
            }
        }

        if (!hasValidTimeSlot) {
            console.warn('‚ùå Kh√¥ng t√¨m th·∫•y khung gi·ªù ph√π h·ª£p');
            
            const khungGioList = bangGia
                .filter(gia => gia.KhungGio)
                .map(gia => `${gia.KhungGio} - ${formatNumber(gia.GiaTien)} VND`)
                .join('\n');

            return {
                price: 0,
                isValid: false,
                message: `Th·ªùi gian ${formatTimeForDisplay(gioHienTai, phutHienTai)} kh√¥ng n·∫±m trong khung gi·ªù ph·ª•c v·ª•.`,
                availableSlots: khungGioList
            };
        }

        console.log(`üí∞ √Åp d·ª•ng khung gi·ªù: ${foundTimeSlot}, Gi√°: ${formatNumber(foundPrice)} VND`);
        return {
            price: foundPrice,
            isValid: true,
            timeSlot: foundTimeSlot
        };
    }

    // C·∫≠p nh·∫≠t gi√° ph√≤ng khi thay ƒë·ªïi ph√≤ng ho·∫∑c th·ªùi gian
    async function updateGiaPhong() {
        const phongSelect = document.querySelector('#phongSelect option:checked');
        const thoiGianBatDau = document.getElementById('thoiGianBatDau').value;
        const giaPhongInput = document.getElementById('giaPhong');
        const warningEl = document.getElementById('giaPhongWarning');
        
        if (!phongSelect || !phongSelect.value || !thoiGianBatDau) {
            giaPhongInput.value = '';
            warningEl.style.display = 'none';
            validateAllFields();
            return;
        }
        
        const maPhong = phongSelect.value;
        
        try {
            // Load b·∫£ng gi√° n·∫øu ch∆∞a c√≥ ho·∫∑c ƒë·ªïi ph√≤ng
            if (!currentRoomPriceTable) {
                await loadRoomPriceTable(maPhong);
            }
            
            // T√≠nh gi√° theo th·ªùi gian
            const result = calculateRoomPriceByTime(thoiGianBatDau, currentRoomPriceTable);
            
            if (result.isValid && result.price > 0) {
                giaPhongInput.value = `${formatNumber(result.price)} VND (${result.timeSlot})`;
                giaPhongInput.setAttribute('data-gia', result.price);
                warningEl.style.display = 'none';
            } else {
                giaPhongInput.value = 'Kh√¥ng c√≥ gi√°';
                giaPhongInput.setAttribute('data-gia', '0');
                warningEl.textContent = `‚ö†Ô∏è ${result.message || 'Ch∆∞a c√≥ gi√° cho khung gi·ªù n√†y'}\n\nC√°c khung gi·ªù hi·ªán c√≥:\n${result.availableSlots || 'Kh√¥ng c√≥'}`;
                warningEl.style.display = 'block';
            }
            
        } catch (err) {
            console.error('‚ùå L·ªói l·∫•y gi√° ph√≤ng:', err);
            giaPhongInput.value = 'L·ªói t·∫£i gi√°';
            giaPhongInput.setAttribute('data-gia', '0');
            warningEl.textContent = '‚ùå Kh√¥ng th·ªÉ t·∫£i b·∫£ng gi√°. Vui l√≤ng th·ª≠ l·∫°i.';
            warningEl.style.display = 'block';
        }
        
        validateAllFields();
    }

    // Helper: Format s·ªë ti·ªÅn
    function formatNumber(amount) {
        return new Intl.NumberFormat('vi-VN').format(amount);
    }

    // Helper: Format th·ªùi gian cho display
    function formatTimeForDisplay(hour, minute) {
        return `${hour}:${minute.toString().padStart(2, '0')}`;
    }

    // Validate t·∫•t c·∫£ tr∆∞·ªùng v√† enable/disable n√∫t submit
    function validateAllFields() {
        const tenKH = document.getElementById('tenKH').value.trim();
        const sdtKH = document.getElementById('sdtKH').value.trim();
        const phongSelect = document.getElementById('phongSelect');
        const selectedPhong = phongSelect?.options[phongSelect.selectedIndex];
        const thoiGianBatDau = document.getElementById('thoiGianBatDau').value;
        const soNguoi = parseInt(document.getElementById('soNguoi').value) || 0;
        const sucChua = parseInt(selectedPhong?.getAttribute('data-succhua')) || 0;
        const giaPhong = document.getElementById('giaPhong').getAttribute('data-gia');
        const submitBtn = document.getElementById('submitBtn');
        
        // Ki·ªÉm tra t·∫•t c·∫£ ƒëi·ªÅu ki·ªán (bao g·ªìm s·ªë ng∆∞·ªùi kh√¥ng v∆∞·ª£t s·ª©c ch·ª©a)
        const isValid = sdtKH && 
                       sdtKH.length === 10 &&
                       tenKH && 
                       phongSelect?.value && 
                       thoiGianBatDau && 
                       soNguoi > 0 && 
                       (sucChua === 0 || soNguoi <= sucChua) &&
                       giaPhong && 
                       parseInt(giaPhong) > 0;
        
        // Enable/disable n√∫t submit
        if (submitBtn) {
            submitBtn.disabled = !isValid;
            
            // Th√™m visual feedback
            if (isValid) {
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            } else {
                submitBtn.style.opacity = '0.5';
                submitBtn.style.cursor = 'not-allowed';
            }
        }
        
        return isValid;
    }

    function formatDateTimeLocal(dateString) {
        if (!dateString) return '';
        
        const date = new Date(dateString);
        if (isNaN(date.getTime())) {
            console.error('‚ùå Invalid date:', dateString);
            return '';
        }
        
        // Format: YYYY-MM-DDTHH:mm (chu·∫©n datetime-local)
        // L·∫•y local time (kh√¥ng c·∫ßn adjust timezone)
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        
        const formatted = `${year}-${month}-${day}T${hours}:${minutes}`;
        console.log('üìÖ Formatted datetime:', dateString, '‚Üí', formatted);
        return formatted;
    }

    function formatCurrency(amount) {
        if (typeof amount === 'string') {
            amount = parseFloat(amount) || 0;
        }
        return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(amount);
    }

    async function saveDatPhong(event) {
        event.preventDefault();

        const datPhongId = document.getElementById('datPhongId').value;
        const isEdit = !!datPhongId;

        // L·∫•y ho·∫∑c t·∫°o m√£ kh√°ch h√†ng
        let maKH = document.getElementById('maKH').value;
        const sdt = document.getElementById('sdtKH').value.trim();
        const tenKH = document.getElementById('tenKH').value.trim();
        
        // Validation kh√°ch h√†ng
        if (!sdt || sdt.length !== 10) {
            showError('Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá (10 s·ªë)');
            return;
        }
        
        if (!tenKH) {
            showError('Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng');
            return;
        }
        
        // N·∫øu ch∆∞a c√≥ m√£ KH (kh√°ch h√†ng m·ªõi), t·∫°o m√£ m·ªõi
        if (!maKH) {
            maKH = `KH${Date.now()}${Math.random().toString(36).substr(2, 5)}`.toUpperCase();
        }
        
        // L·∫•y th√¥ng tin ph√≤ng
        const selectedPhong = document.querySelector('#phongSelect option:checked');
        const tenPhong = selectedPhong?.textContent || 'Ph√≤ng karaoke';
        const loaiPhong = selectedPhong?.getAttribute('data-loaiphong') || 'Th∆∞·ªùng';
        const maPhong = document.getElementById('phongSelect').value;
        const soNguoi = parseInt(document.getElementById('soNguoi').value);
        const thoiGianBatDauInput = document.getElementById('thoiGianBatDau').value;
        const ghiChu = document.getElementById('ghiChu').value || '';
        
        // FIX: Validate v√† parse datetime - QUAN TR·ªåNG!
        if (!thoiGianBatDauInput) {
            showError('Vui l√≤ng ch·ªçn th·ªùi gian b·∫Øt ƒë·∫ßu');
            return;
        }
        
        console.log('üìÖ Input datetime value:', thoiGianBatDauInput);
        
        // Datetime-local format: "2025-12-23T18:30"
        const thoiGianBatDau = new Date(thoiGianBatDauInput);
        
        if (isNaN(thoiGianBatDau.getTime())) {
            console.error('‚ùå Invalid datetime:', thoiGianBatDauInput);
            showError('Th·ªùi gian b·∫Øt ƒë·∫ßu kh√¥ng h·ª£p l·ªá. Vui l√≤ng ch·ªçn l·∫°i.');
            return;
        }
        
        console.log('‚úÖ Parsed datetime:', thoiGianBatDau.toISOString());
        
        // Ki·ªÉm tra gi√° ph√≤ng
        const giaPhongInput = document.getElementById('giaPhong');
        const giaPhong = parseInt(giaPhongInput.getAttribute('data-gia')) || 0;
        
        // Format data - Kh√°c nhau gi·ªØa CREATE v√† EDIT
        let formData;
        
        if (isEdit) {
            // EDIT: G·ª≠i √≠t data h∆°n, ch·ªâ nh·ªØng g√¨ c·∫ßn update
            const maDatPhong = document.getElementById('datPhongMaDP').value;
            formData = {
                MaPhong: maPhong,
                SoNguoi: soNguoi,
                ThoiGianBatDau: thoiGianBatDau.toISOString(),
                GhiChu: ghiChu
            };
            console.log('üìù EDIT mode - Form data:', formData);
        } else {
            // CREATE: G·ª≠i ƒë·∫ßy ƒë·ªß data
            const maDatPhong = `DP${Date.now()}${Math.random().toString(36).substr(2, 5)}`.toUpperCase();
            formData = {
                // Th√¥ng tin kh√°ch h√†ng
                maKH: maKH,
                tenKH: tenKH,
                sdt: sdt,
                email: '',
                
                // Th√¥ng tin ƒë·∫∑t ph√≤ng
                maDatPhong: maDatPhong,
                maPhong: maPhong,
                tenPhong: tenPhong,
                loaiPhong: loaiPhong,
                giaTien: giaPhong,
                
                // Th·ªùi gian - G·ª¨I ISO STRING
                thoiGianBatDau: thoiGianBatDau.toISOString(),
                thoiGianKetThuc: null,
                songuoi: soNguoi,
                
                // Ghi ch√∫ v√† tr·∫°ng th√°i
                ghiChu: ghiChu,
                trangThai: 'ƒê√£ ƒë·∫∑t'
            };
            console.log('‚ûï CREATE mode - Form data:', formData);
        }

        // Validation - Th·ªëng nh·∫•t key cho c·∫£ CREATE v√† EDIT
        const maPhongToCheck = formData.MaPhong || formData.maPhong;
        const soNguoiToCheck = formData.SoNguoi || formData.songuoi;
        
        if (!maPhongToCheck) {
            showError('Vui l√≤ng ch·ªçn ph√≤ng');
            return;
        }
        
        if (!soNguoiToCheck || soNguoiToCheck < 1) {
            showError('Vui l√≤ng nh·∫≠p s·ªë ng∆∞·ªùi h·ª£p l·ªá (t·ªëi thi·ªÉu 1)');
            return;
        }
        
        // Ki·ªÉm tra s·ªë ng∆∞·ªùi kh√¥ng v∆∞·ª£t qu√° s·ª©c ch·ª©a
        const sucChua = parseInt(selectedPhong?.getAttribute('data-succhua')) || 0;
        if (sucChua && soNguoiToCheck > sucChua) {
            showError(`S·ªë ng∆∞·ªùi (${soNguoiToCheck}) v∆∞·ª£t qu√° s·ª©c ch·ª©a ph√≤ng (${sucChua} ng∆∞·ªùi)`);
            return;
        }

        // ƒê√£ validate datetime ·ªü tr√™n r·ªìi
        
        // Ki·ªÉm tra gi√° ph√≤ng - CH·ªà KHI T·∫†O M·ªöI
        if (!isEdit) {
            if (!formData.giaTien || formData.giaTien === 0) {
                showError('Kh√¥ng c√≥ gi√° ph√≤ng cho khung gi·ªù ƒë√£ ch·ªçn. Vui l√≤ng ch·ªçn th·ªùi gian kh√°c.');
                return;
            }
        }

        // TH√äM CONFIRMATION DIALOG - Pattern t·ª´ home.js
        try {
            // L·∫•y data hi·ªÉn th·ªã - h·ªó tr·ª£ c·∫£ CREATE v√† EDIT
            const thoiGian = new Date(formData.ThoiGianBatDau || formData.thoiGianBatDau).toLocaleString('vi-VN');
            const displayTenPhong = formData.tenPhong || tenPhong;
            const displaySoNguoi = formData.SoNguoi || formData.songuoi;
            const displayGiaPhong = formData.giaTien || giaPhong;
            
            const confirmResult = await Swal.fire({
                title: isEdit ? 'X√°c nh·∫≠n c·∫≠p nh·∫≠t?' : 'X√°c nh·∫≠n ƒë·∫∑t ph√≤ng?',
                html: `
                    <div class="text-start">
                        <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ${isEdit ? 'c·∫≠p nh·∫≠t' : 'ƒë·∫∑t'} ph√≤ng <strong>${displayTenPhong}</strong>?</p>
                        <div class="mt-3 p-3 bg-light rounded">
                            <p class="mb-2"><i class="fas fa-clock"></i> <strong>Th·ªùi gian:</strong> ${thoiGian}</p>
                            <p class="mb-2"><i class="fas fa-users"></i> <strong>S·ªë ng∆∞·ªùi:</strong> ${displaySoNguoi}</p>
                            ${!isEdit ? `<p class="mb-0"><i class="fas fa-money-bill"></i> <strong>Gi√° ph√≤ng:</strong> ${formatCurrency(displayGiaPhong)}</p>` : ''}
                        </div>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: isEdit ? '<i class="fas fa-check"></i> C·∫≠p nh·∫≠t' : '<i class="fas fa-check-double"></i> ƒê·∫∑t ngay',
                cancelButtonText: '<i class="fas fa-times"></i> H·ªßy b·ªè',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                reverseButtons: true,
                width: '500px'
            });

            // N·∫øu ng∆∞·ªùi d√πng kh√¥ng x√°c nh·∫≠n, d·ª´ng l·∫°i
            if (!confirmResult.isConfirmed) {
                console.log('User cancelled booking');
                return;
            }

            // Ti·∫øp t·ª•c x·ª≠ l√Ω - Hi·ªÉn th·ªã loading state
            showLoadingButton();

            const url = isEdit ? `/api/datphong/${document.getElementById('datPhongMaDP').value}` : '/api/datphong';
            const method = isEdit ? 'PUT' : 'POST';

            const response = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });

            const result = await response.json();
            
            hideLoadingButton();
            
            if (!response.ok) throw new Error(result.error || 'L·ªói server');

            // ƒê√≥ng modal TR∆Ø·ªöC
            closeDatPhongModal();
            
            // ƒê·ª£i modal ƒë√≥ng ho√†n to√†n (quan tr·ªçng!)
            await new Promise(resolve => setTimeout(resolve, 400));

            // Chu·∫©n b·ªã data hi·ªÉn th·ªã - h·ªó tr·ª£ c·∫£ CREATE v√† EDIT
            const maDatPhongDisplay = result.data?.maDatPhong || formData.maDatPhong || document.getElementById('datPhongMaDP')?.value || 'N/A';
            const tenPhongDisplay = formData.tenPhong || tenPhong;
            const thoiGianDisplay = formData.ThoiGianBatDau || formData.thoiGianBatDau;
            const soNguoiDisplay = formData.SoNguoi || formData.songuoi;
            const giaPhongDisplay = formData.giaTien || giaPhong;

            // SAU ƒê√ì m·ªõi hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng chi ti·∫øt v√† ch·ªù ng∆∞·ªùi d√πng b·∫•m OK
            await Swal.fire({
                title: isEdit ? 'C·∫≠p nh·∫≠t th√†nh c√¥ng!' : 'ƒê·∫∑t ph√≤ng th√†nh c√¥ng!',
                html: `
                    <div class="text-center">
                        <div class="mb-4">
                            <i class="fas fa-check-circle text-success" style="font-size: 3rem;"></i>
                        </div>
                        <p class="mb-4">${result.message || (isEdit ? 'ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin ƒë·∫∑t ph√≤ng' : 'ƒê·∫∑t ph√≤ng th√†nh c√¥ng!')}</p>
                        <div class="booking-summary p-3 bg-light rounded text-start">
                            <h6 class="mb-3"><i class="fas fa-info-circle"></i> Th√¥ng tin ƒë·∫∑t ph√≤ng:</h6>
                            <p><strong>M√£ ƒë·∫∑t ph√≤ng:</strong> ${maDatPhongDisplay}</p>
                            <p><strong>Ph√≤ng:</strong> ${tenPhongDisplay}</p>
                            <p><strong>Th·ªùi gian:</strong> ${new Date(thoiGianDisplay).toLocaleString('vi-VN')}</p>
                            <p><strong>S·ªë ng∆∞·ªùi:</strong> ${soNguoiDisplay}</p>
                            ${!isEdit ? `<p><strong>Gi√° ph√≤ng:</strong> ${formatCurrency(giaPhongDisplay)}</p>` : ''}
                            <p class="mb-0"><strong>Tr·∫°ng th√°i:</strong> <span class="badge bg-success">${isEdit ? 'ƒê√£ c·∫≠p nh·∫≠t' : 'ƒê√£ ƒë·∫∑t th√†nh c√¥ng'}</span></p>
                        </div>
                    </div>
                `,
                icon: 'success',
                confirmButtonText: '<i class="fas fa-check"></i> OK',
                confirmButtonColor: '#3085d6',
                width: '600px',
                allowOutsideClick: false,
                allowEscapeKey: false,
                customClass: {
                    container: 'swal2-top-level'
                }
            });
            
            // Reload trang sau khi ng∆∞·ªùi d√πng b·∫•m OK
            location.reload();

        } catch (error) {
            hideLoadingButton();
            console.error('‚ùå L·ªói khi l∆∞u ƒë·∫∑t ph√≤ng:', error);
            Swal.fire({
                icon: 'error',
                title: 'L·ªói!',
                html: `
                    <p>${error.message || 'Kh√¥ng th·ªÉ l∆∞u ƒë·∫∑t ph√≤ng'}</p>
                    <p class="text-muted small">Vui l√≤ng th·ª≠ l·∫°i sau ho·∫∑c li√™n h·ªá qu·∫£n tr·ªã vi√™n.</p>
                `,
                confirmButtonText: '<i class="fas fa-times"></i> ƒê√≥ng',
                confirmButtonColor: '#d33'
            });
        }
    }

    // Helper functions cho loading state - Pattern t·ª´ home.js
    function showLoadingButton() {
        const submitBtn = document.getElementById('submitBtn');
        
        if (!submitBtn) {
            console.error('Kh√¥ng t√¨m th·∫•y n√∫t submit');
            return;
        }
        
        // L∆∞u tr·∫°ng th√°i ban ƒë·∫ßu
        submitBtn.setAttribute('data-original-html', submitBtn.innerHTML);
        
        // Thay ƒë·ªïi n·ªôi dung v√† disable button
        submitBtn.innerHTML = `
            <i class="fas fa-spinner fa-spin"></i>
            <span>ƒêang x·ª≠ l√Ω...</span>
        `;
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.7';
        submitBtn.style.cursor = 'not-allowed';
    }

    function hideLoadingButton() {
        const submitBtn = document.getElementById('submitBtn');
        
        if (!submitBtn) return;
        
        // Kh√¥i ph·ª•c tr·∫°ng th√°i ban ƒë·∫ßu
        const originalHtml = submitBtn.getAttribute('data-original-html');
        if (originalHtml) {
            submitBtn.innerHTML = originalHtml;
            submitBtn.removeAttribute('data-original-html');
        }
        submitBtn.disabled = false;
        submitBtn.style.opacity = '1';
        submitBtn.style.cursor = 'pointer';
    }

    // ===== CHECK-IN V√Ä CHUY·ªÇN TH√ÄNH H√ìA ƒê∆†N =====
    async function checkInDatPhong(maDatPhong) {
        try {
            // Ki·ªÉm tra xem ƒë√£ qu√° gi·ªù ch∆∞a
            const datPhongResponse = await fetch(`/api/datphong/${maDatPhong}`);
            if (!datPhongResponse.ok) {
                throw new Error('Kh√¥ng t√¨m th·∫•y ƒë·∫∑t ph√≤ng');
            }
            
            const datPhong = await datPhongResponse.json();
            const now = new Date();
            const thoiGianBatDau = new Date(datPhong.ThoiGianBatDau);
            
            // Ki·ªÉm tra n·∫øu qu√° th·ªùi gian b·∫Øt ƒë·∫ßu 15 ph√∫t
            const thoiGianQuaHan = new Date(thoiGianBatDau.getTime() + 15000 * 60000); // +15 ph√∫t
            
            if (now > thoiGianQuaHan) {
                Swal.fire({
                    icon: 'error',
                    title: 'Kh√¥ng th·ªÉ check-in',
                    text: 'ƒê√£ qu√° th·ªùi gian cho ph√©p check-in (15 ph√∫t sau gi·ªù ƒë·∫∑t)',
                    confirmButtonColor: '#667eea'
                });
                return;
            }

            Swal.fire({
                title: 'Check-in kh√°ch h√†ng?',
                html: `
                    <div style="text-align: left; padding: 10px;">
                        <p style="margin-bottom: 10px;">üìã <strong>Khi check-in th√†nh c√¥ng:</strong></p>
                        <ul style="list-style: none; padding-left: 0;">
                            <li>‚úÖ T·∫°o h√≥a ƒë∆°n m·ªõi v·ªõi tr·∫°ng th√°i "Ch·ªù thanh to√°n"</li>
                            <li>‚è±Ô∏è B·∫Øt ƒë·∫ßu t√≠nh gi·ªù s·ª≠ d·ª•ng ph√≤ng</li>
                            <li>üìä ƒê∆°n ƒë·∫∑t ph√≤ng chuy·ªÉn sang tr·∫°ng th√°i "Ho√†n th√†nh"</li>
                            <li>üìÑ Xem h√≥a ƒë∆°n t·∫°i trang "Qu·∫£n l√Ω h√≥a ƒë∆°n"</li>
                        </ul>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#48bb78',
                cancelButtonColor: '#a0aec0',
                confirmButtonText: '‚úì X√°c nh·∫≠n check-in',
                cancelButtonText: '‚úó H·ªßy'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        // G·ªçi API check-in ƒë·ªÉ t·∫°o h√≥a ƒë∆°n
                        const response = await fetch(`/api/datphong/${maDatPhong}/checkin`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' }
                        });

                        if (!response.ok) {
                            const errorResult = await response.json();
                            throw new Error(errorResult.error || 'L·ªói server');
                        }

                        const apiResult = await response.json();
                        console.log('‚úÖ Check-in th√†nh c√¥ng:', apiResult);

                        // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng v·ªõi th√¥ng tin h√≥a ƒë∆°n
                        await Swal.fire({
                            icon: 'success',
                            title: 'Check-in th√†nh c√¥ng!',
                            html: `
                                <div style="text-align: left; padding: 10px;">
                                    <p style="margin-bottom: 10px;">‚úÖ <strong>ƒê√£ t·∫°o h√≥a ƒë∆°n m·ªõi:</strong></p>
                                    <ul style="list-style: none; padding-left: 0;">
                                        <li>üìã M√£ h√≥a ƒë∆°n: <strong>${apiResult.data?.hoaDon?.MaHoaDon || 'N/A'}</strong></li>
                                        <li>üè† Ph√≤ng: <strong>${apiResult.data?.hoaDon?.MaPhong || 'N/A'}</strong></li>
                                        <li>‚è±Ô∏è B·∫Øt ƒë·∫ßu: <strong>${apiResult.data?.hoaDon?.ThoiGianBatDau ? new Date(apiResult.data.hoaDon.ThoiGianBatDau).toLocaleString('vi-VN') : 'N/A'}</strong></li>
                                        <li>üìä ƒê∆°n ƒë·∫∑t ph√≤ng: <strong>Ho√†n th√†nh</strong></li>
                                    </ul>
                                    <p style="margin-top: 15px; color: #4299e1;">
                                        üí° Xem h√≥a ƒë∆°n t·∫°i <strong>Qu·∫£n l√Ω h√≥a ƒë∆°n</strong>
                                    </p>
                                </div>
                            `,
                            confirmButtonColor: '#48bb78',
                            confirmButtonText: 'OK'
                        });

                        setTimeout(() => {
                            location.reload();
                        }, 1000);
                        
                    } catch (error) {
                        console.error('‚ùå L·ªói khi check-in:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'L·ªói!',
                            text: error.message || 'Kh√¥ng th·ªÉ check-in',
                            confirmButtonColor: '#667eea'
                        });
                    }
                }
            });
            
        } catch (error) {
            console.error('‚ùå L·ªói khi ki·ªÉm tra ƒë·∫∑t ph√≤ng:', error);
            Swal.fire({
                icon: 'error',
                title: 'L·ªói!',
                text: 'Kh√¥ng th·ªÉ ki·ªÉm tra th√¥ng tin ƒë·∫∑t ph√≤ng',
                confirmButtonColor: '#667eea'
            });
        }
    }

    async function checkOutDatPhong(maDatPhong) {
        try {
            const response = await fetch(`/api/datphong/${maDatPhong}/checkout`, {
                method: 'PUT'
            });

            if (response.ok) {
                Swal.fire({
                    icon: 'success',
                    title: 'Th√†nh c√¥ng!',
                    text: 'ƒê√£ check-out kh√°ch h√†ng',
                    timer: 1500,
                    showConfirmButton: false
                });
                setTimeout(() => location.reload(), 1500);
            } else {
                throw new Error('L·ªói khi check-out');
            }
        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'L·ªói!',
                text: 'Kh√¥ng th·ªÉ check-out'
            });
        }
    }

    // ===== MODAL MANAGEMENT =====
    async function viewDatPhongDetail(maDatPhong) {
        try {
            // Hi·ªÉn th·ªã loading
            const detailContent = document.getElementById('detailContent');
            detailContent.innerHTML = `
            <div class="loading-invoice">
                <div class="loading-spinner"></div>
                <p>ƒêang t·∫£i th√¥ng tin ƒë·∫∑t ph√≤ng...</p>
            </div>
        `;

            // Hi·ªÉn th·ªã modal
            const detailModal = document.getElementById('detailModal');
            detailModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // L·∫•y th√¥ng tin ƒë·∫∑t ph√≤ng
            const response = await fetch(`/api/datphong/${maDatPhong}`);
            if (!response.ok) {
                throw new Error('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu ƒë·∫∑t ph√≤ng');
            }

            const datPhong = await response.json();
            console.log(datPhong);

            // C·∫≠p nh·∫≠t ng√†y ƒë·∫∑t v·ªõi th·ªùi gian 
            document.getElementById('modal-booking-date').textContent =
                `${formatDate(datPhong.createdAt)} ${formatTime(datPhong.createdAt)}`;

            // C·∫¨P NH·∫¨T HEADER V·ªöI TH√îNG TIN T·ª™ API
            document.getElementById('modal-booking-number').textContent = `${datPhong.MaDatPhong}`;

            const statusElement = document.getElementById('modal-booking-status');
            statusElement.textContent = datPhong.TrangThai;
            statusElement.className = `value status-badge ${datPhong.TrangThai === 'ƒêang s·ª≠ d·ª•ng' ? 'active' : datPhong.TrangThai === 'S·∫Øp t·ªõi' ? 'pending' : datPhong.TrangThai === 'ƒê√£ k·∫øt th√∫c' ? 'completed' : 'cancelled'}`;

            // C·∫¨P NH·∫¨T N√öT H√ÄNH ƒê·ªòNG TRONG HEADER
            updateHeaderActions(maDatPhong, datPhong.TrangThai);

            // Render ph·∫ßn body c·ªßa ƒë·∫∑t ph√≤ng
            renderBookingBody(datPhong);

        } catch (error) {
            console.error('L·ªói khi t·∫£i chi ti·∫øt ƒë·∫∑t ph√≤ng:', error);
            detailContent.innerHTML = `
            <div class="error-state">
                <div class="error-icon">‚ùå</div>
                <h3>Kh√¥ng th·ªÉ t·∫£i ƒë·∫∑t ph√≤ng</h3>
                <p>${error.message || 'Vui l√≤ng th·ª≠ l·∫°i sau'}</p>
                <button class="btn-primary" onclick="viewDatPhongDetail('${maDatPhong}')">
                    <i class="fas fa-redo"></i>
                    Th·ª≠ l·∫°i
                </button>
            </div>
        `;
        }
    }

    // ===== C·∫¨P NH·∫¨T N√öT H√ÄNH ƒê·ªòNG TRONG HEADER =====
    function updateHeaderActions(maDatPhong, trangThai) {
        const headerActions = document.getElementById('headerActions');

        let actionButtons = '';

        if (trangThai === 'S·∫Øp t·ªõi') {
            actionButtons = `
            <button class="btn-checkin-detail" onclick="checkInDatPhong('${maDatPhong}')">
                <i class="fas fa-sign-in-alt"></i>
                Check-in
            </button>
        `;
        } else if (trangThai === 'ƒêang s·ª≠ d·ª•ng') {
            actionButtons = `
            <button class="btn-checkout-detail" onclick="checkOutDatPhong('${maDatPhong}')">
                <i class="fas fa-sign-out-alt"></i>
                Check-out
            </button>
        `;
        }

        // Th√™m n√∫t ƒë√≥ng ·ªü g√≥c tr√™n b√™n ph·∫£i
        actionButtons += `
        <button class="modal-close" onclick="closeDetailModal()">
            <i class="fas fa-times"></i>
        </button>
    `;

        headerActions.innerHTML = actionButtons;
    }

    // ===== H√ÄM ƒê√ìNG MODAL CHI TI·∫æT =====
    function closeDetailModal() {
        const detailModal = document.getElementById('detailModal');
        detailModal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    // ===== S·ª∞ KI·ªÜN CLICK RA NGO√ÄI ƒê·ªÇ ƒê√ìNG MODAL =====
    // Pagination Class
    class BookingPagination {
        constructor() {
            this.currentPage = 1;
            this.itemsPerPage = 10;
            this.maxVisiblePages = 5;
            this.allRows = [];
            this.filteredRows = [];
        }

        init() {
            this.allRows = Array.from(document.querySelectorAll('#datPhongTableBody tr'));
            this.filteredRows = [...this.allRows];
            this.setupEventListeners();
            this.showPage(1);
        }

        setupEventListeners() {
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            
            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.showPage(this.currentPage - 1);
                    }
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    if (this.currentPage < this.getTotalPages()) {
                        this.showPage(this.currentPage + 1);
                    }
                });
            }
        }

        applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFrom = document.getElementById('dateFromFilter').value;
            const dateTo = document.getElementById('dateToFilter').value;

            this.filteredRows = this.allRows.filter(row => {
                const madp = row.getAttribute('data-madp').toLowerCase();
                const maphong = row.getAttribute('data-maphong').toLowerCase();
                const customer = row.getAttribute('data-customer').toLowerCase();
                const status = row.getAttribute('data-status');
                const dateStr = row.getAttribute('data-date');

                const matchesSearch = !searchTerm || madp.includes(searchTerm) || maphong.includes(searchTerm) || customer.includes(searchTerm);
                const matchesStatus = !statusFilter || status === statusFilter;
                
                let matchesDateRange = true;
                if (dateFrom || dateTo) {
                    const bookingDate = new Date(dateStr);
                    if (dateFrom && new Date(dateFrom) > bookingDate) matchesDateRange = false;
                    if (dateTo && new Date(dateTo) < bookingDate) matchesDateRange = false;
                }

                return matchesSearch && matchesStatus && matchesDateRange;
            });

            this.currentPage = 1;
            this.showPage(1);
            toggleEmptyState(this.filteredRows.length === 0);
        }

        getTotalPages() {
            return Math.ceil(this.filteredRows.length / this.itemsPerPage);
        }

        showPage(pageNum) {
            this.currentPage = pageNum;
            const startIndex = (pageNum - 1) * this.itemsPerPage;
            const endIndex = startIndex + this.itemsPerPage;

            this.allRows.forEach(row => row.style.display = 'none');
            this.filteredRows.forEach((row, index) => {
                if (index >= startIndex && index < endIndex) {
                    row.style.display = '';
                }
            });

            this.updatePaginationUI();
        }

        updatePaginationUI() {
            const totalPages = this.getTotalPages();
            const startIndex = (this.currentPage - 1) * this.itemsPerPage + 1;
            const endIndex = Math.min(this.currentPage * this.itemsPerPage, this.filteredRows.length);

            const startEl = document.getElementById('startIndex');
            const endEl = document.getElementById('endIndex');
            const totalEl = document.getElementById('totalBookings');

            if (startEl) startEl.textContent = this.filteredRows.length > 0 ? startIndex : 0;
            if (endEl) endEl.textContent = endIndex;
            if (totalEl) totalEl.textContent = this.filteredRows.length;

            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            
            if (prevBtn) prevBtn.disabled = this.currentPage === 1;
            if (nextBtn) nextBtn.disabled = this.currentPage === totalPages || totalPages === 0;

            this.renderPageNumbers();

            const paginationContainer = document.getElementById('paginationContainer');
            if (paginationContainer) {
                paginationContainer.style.display = this.filteredRows.length > 0 ? 'flex' : 'none';
            }
        }

        renderPageNumbers() {
            const pageNumbersContainer = document.getElementById('pageNumbers');
            if (!pageNumbersContainer) return;
            
            pageNumbersContainer.innerHTML = '';
            
            const totalPages = this.getTotalPages();
            if (totalPages <= 1) return;

            const createPageButton = (pageNum) => {
                const btn = document.createElement('button');
                btn.className = 'pagination-page' + (pageNum === this.currentPage ? ' active' : '');
                btn.textContent = pageNum;
                btn.addEventListener('click', () => this.showPage(pageNum));
                return btn;
            };

            const createEllipsis = () => {
                const span = document.createElement('span');
                span.className = 'pagination-ellipsis';
                span.textContent = '...';
                return span;
            };

            if (totalPages <= this.maxVisiblePages) {
                for (let i = 1; i <= totalPages; i++) {
                    pageNumbersContainer.appendChild(createPageButton(i));
                }
            } else {
                pageNumbersContainer.appendChild(createPageButton(1));

                if (this.currentPage > 3) {
                    pageNumbersContainer.appendChild(createEllipsis());
                }

                const startPage = Math.max(2, this.currentPage - 1);
                const endPage = Math.min(totalPages - 1, this.currentPage + 1);

                for (let i = startPage; i <= endPage; i++) {
                    pageNumbersContainer.appendChild(createPageButton(i));
                }

                if (this.currentPage < totalPages - 2) {
                    pageNumbersContainer.appendChild(createEllipsis());
                }

                pageNumbersContainer.appendChild(createPageButton(totalPages));
            }
        }
    }

    let bookingPagination;

    document.addEventListener('DOMContentLoaded', function () {
        // Initialize pagination
        bookingPagination = new BookingPagination();
        bookingPagination.init();
        
        // S·ª± ki·ªán cho modal chi ti·∫øt
        const detailModal = document.getElementById('detailModal');
        if (detailModal) {
            detailModal.addEventListener('click', function (event) {
                if (event.target === detailModal) {
                    closeDetailModal();
                }
            });
        }

        // S·ª± ki·ªán cho modal ƒë·∫∑t ph√≤ng
        const datPhongModal = document.getElementById('datPhongModal');
        if (datPhongModal) {
            datPhongModal.addEventListener('click', function (event) {
                if (event.target === datPhongModal) {
                    closeDatPhongModal();
                }
            });
        }
    });

    // ===== H√ÄM ƒê√ìNG MODAL ƒê·∫∂T PH√íNG =====
    function closeDatPhongModal() {
        const datPhongModal = document.getElementById('datPhongModal');
        datPhongModal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }



    // ===== RENDER PH·∫¶N BODY C·ª¶A ƒê·∫∂T PH√íNG =====
    function renderBookingBody(datPhong) {
        const detailContent = document.getElementById('detailContent');

        detailContent.innerHTML = `
      <div class="modern-invoice" id="printableInvoice">
        <!-- Th√¥ng tin kh√°ch h√†ng v√† ph√≤ng -->
        <div class="invoice-customer-info">
          <div class="info-section">
            <h3>Th√¥ng tin kh√°ch h√†ng</h3>
            <div class="info-grid">
              <div class="info-item">
                <span class="label">M√£ KH:</span>
                <span class="value">${datPhong.MaKH || 'N/A'}</span>
              </div>
              <div class="info-item">
                <span class="label">T√™n KH:</span>
                <!-- S·ª¨A: D√πng KhachHang thay v√¨ ChiTiet -->
                <span class="value">${datPhong.KhachHang ? datPhong.KhachHang.TenKH : 'N/A'}</span>
              </div>
              <div class="info-item">
                <span class="label">SƒêT:</span>
                <!-- S·ª¨A: D√πng KhachHang thay v√¨ ChiTiet -->
                <span class="value">${datPhong.KhachHang ? datPhong.KhachHang.SDT : 'N/A'}</span>
              </div>
            </div>
          </div>
          <div class="info-section">
            <h3>Th√¥ng tin ph√≤ng</h3>
            <div class="info-grid">
              <div class="info-item">
                <span class="label">Ph√≤ng:</span>
                <span class="value">${datPhong.MaPhong || 'N/A'} (${datPhong.SoNguoi || 'N/A'} ng∆∞·ªùi) </span>
              </div>
              <div class="info-item">
                <span class="label">Th·ªùi gian:</span>
                <span class="value">${formatTime(datPhong.ThoiGianBatDau)}</span>
              </div>
              <div class="info-item">
                <span class="label">Ng√†y:</span>
                <span class="value">${formatDate(datPhong.ThoiGianBatDau)}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Th·ªùi gian ƒë·∫∑t ph√≤ng -->
        <div class="invoice-services">
          <h3>Th·ªùi gian ƒë·∫∑t ph√≤ng</h3>
          <div class="services-table">
            <div class="table-header">
              <div class="col-service">S·ª± ki·ªán</div>
              <div class="col-date">Ng√†y</div>
              <div class="col-time">Th·ªùi gian</div>
            </div>
            
            <div class="table-row">
              <div class="col-service">
                <span class="service-name">Check In</span>
              </div>
              <div class="col-date">${formatDate(datPhong.ThoiGianBatDau)}</div>
              <div class="col-time">${formatTime(datPhong.ThoiGianBatDau)}</div>
            </div>
          </div>
        </div>

        <!-- Th√¥ng tin tr·∫°ng th√°i -->
        <div class="invoice-summary">
          <div class="summary-row">
            <span class="label">Tr·∫°ng th√°i:</span>
            <span class="value status-badge ${datPhong.TrangThai === 'ƒêang s·ª≠ d·ª•ng' ? 'active' : datPhong.TrangThai === 'S·∫Øp t·ªõi' ? 'pending' : datPhong.TrangThai === 'ƒê√£ k·∫øt th√∫c' ? 'completed' : 'cancelled'}">${datPhong.TrangThai}</span>
          </div>
          <div class="summary-row">
            <span class="label">Th·ªùi gian t·∫°o:</span>
            <span class="value">${formatDateTime(datPhong.createdAt)}</span>
          </div>
          ${datPhong.updatedAt ? `
          <div class="summary-row">
            <span class="label">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi:</span>
            <span class="value">${formatDateTime(datPhong.updatedAt)}</span>
          </div>
          ` : ''}
        </div>

        <!-- Ghi ch√∫ -->
        ${datPhong.GhiChu ? `
        <div class="invoice-payment">
          <div class="payment-notes full-width">
            <h4>Ghi ch√∫</h4>
            <p>${datPhong.GhiChu}</p>
          </div>
        </div>
        ` : ''}

        <!-- Footer ƒë·∫∑t ph√≤ng -->
        <div class="invoice-footer">
          <div class="footer-signature">
            <div class="signature-line"></div>
            <p>Ch·ªØ k√Ω nh√¢n vi√™n</p>
          </div>
          <div class="footer-thanks">
            <p><strong>KARAOKE NNICE</strong></p>
            <p>Hotline: (028)3 5170046</p>
          </div>
        </div>
      </div>
    `;
    }

    // ===== FILTER & SEARCH =====
    function filterDatPhong() {
        if (bookingPagination) {
            bookingPagination.applyFilters();
        }
        calculateFilteredStatistics();
    }

    function sortDatPhongs(sortType) {
        const container = document.getElementById('datPhongGrid');
        const cards = Array.from(container.querySelectorAll('.employee-card'));

        cards.sort((a, b) => {
            switch (sortType) {
                case 'newest':
                    return new Date(b.getAttribute('data-date')) - new Date(a.getAttribute('data-date'));
                case 'oldest':
                    return new Date(a.getAttribute('data-date')) - new Date(b.getAttribute('data-date'));
                default:
                    return 0;
            }
        });

        cards.forEach(card => container.appendChild(card));
    }

    function clearFilters() {
        document.getElementById('searchInput').value = '';
        document.getElementById('statusFilter').value = '';
        document.getElementById('dateFromFilter').value = '';
        document.getElementById('dateToFilter').value = '';
        document.getElementById('sortFilter').value = 'newest';

        filterDatPhong();
    }

    function toggleEmptyState(show) {
        const emptyState = document.getElementById('emptyState');
        const table = document.getElementById('datPhongTable');
        const paginationContainer = document.getElementById('paginationContainer');

        if (!emptyState || !table) return;

        if (show) {
            table.style.display = 'none';
            if (paginationContainer) paginationContainer.style.display = 'none';
            emptyState.style.display = 'block';
        } else {
            table.style.display = 'block';
            if (paginationContainer) paginationContainer.style.display = 'flex';
            emptyState.style.display = 'none';
        }
    }

    // ===== UTILITY FUNCTIONS =====
    function showError(message) {
        Swal.fire({
            icon: 'warning',
            title: 'Thi·∫øu th√¥ng tin',
            text: message,
            confirmButtonColor: '#667eea'
        });
    }

    // ===== AUTO CANCEL BOOKINGS =====
    async function checkAndAutoCancelBookings() {
        try {
            // L·∫•y t·∫•t c·∫£ c√°c ƒë∆°n c√≥ tr·∫°ng th√°i "ƒê√£ ƒë·∫∑t" ho·∫∑c "S·∫Øp t·ªõi"
            const tableRows = document.querySelectorAll('#datPhongTableBody tr');
            const currentTime = new Date();
            
            for (const row of tableRows) {
                const status = row.getAttribute('data-status');
                
                // Ch·ªâ ki·ªÉm tra ƒë∆°n c√≥ tr·∫°ng th√°i "ƒê√£ ƒë·∫∑t" ho·∫∑c "S·∫Øp t·ªõi"
                if (status !== 'ƒê√£ ƒë·∫∑t' && status !== 'S·∫Øp t·ªõi') continue;
                
                const startTimeStr = row.getAttribute('data-start');
                const maDatPhong = row.getAttribute('data-madp');
                
                if (!startTimeStr || !maDatPhong) continue;
                
                // Parse th·ªùi gian b·∫Øt ƒë·∫ßu (format: "DD/MM/YYYY, HH:MM:SS" t·ª´ formatDateTime)
                const startTime = parseVietnameseDateTime(startTimeStr);
                if (!startTime || isNaN(startTime.getTime())) continue;
                
                const timeDiff = (currentTime - startTime) / (1000 * 60); // Ch√™nh l·ªách t√≠nh b·∫±ng ph√∫t
                
                // N·∫øu qu√° 30 ph√∫t t·ª´ th·ªùi gian b·∫Øt ƒë·∫ßu
                if (timeDiff > 30) {
                    console.log(`üö´ T·ª± ƒë·ªông h·ªßy ƒë∆°n ${maDatPhong} - Qu√° 30 ph√∫t kh√¥ng check-in`);
                    
                    // G·ªçi API ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh "ƒê√£ h·ªßy"
                    const response = await fetch(`/api/datphong/${maDatPhong}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            TrangThai: 'ƒê√£ h·ªßy',
                            GhiChu: 'T·ª± ƒë·ªông h·ªßy do kh√¥ng check-in sau 30 ph√∫t'
                        })
                    });
                    
                    if (response.ok) {
                        // C·∫≠p nh·∫≠t UI
                        row.setAttribute('data-status', 'ƒê√£ h·ªßy');
                        const statusBadge = row.querySelector('.status-badge');
                        if (statusBadge) {
                            statusBadge.textContent = '‚ùå ƒê√£ h·ªßy';
                            statusBadge.className = 'status-badge status-danger';
                        }
                        
                        // Hi·ªÉn th·ªã th√¥ng b√°o
                        Swal.fire({
                            icon: 'info',
                            title: 'ƒê∆°n ƒë√£ b·ªã h·ªßy',
                            text: `ƒê∆°n ${maDatPhong} ƒë√£ t·ª± ƒë·ªông h·ªßy do kh√¥ng check-in sau 30 ph√∫t`,
                            timer: 3000,
                            showConfirmButton: false,
                            toast: true,
                            position: 'top-end'
                        });
                        
                        // C·∫≠p nh·∫≠t l·∫°i th·ªëng k√™
                        if (bookingPagination) {
                            bookingPagination.applyFilters();
                        }
                        calculateStatistics();
                    }
                }
            }
        } catch (error) {
            console.error('‚ùå L·ªói khi ki·ªÉm tra t·ª± ƒë·ªông h·ªßy:', error);
        }
    }

    // Helper function ƒë·ªÉ parse datetime t·ª´ format Vi·ªát Nam
    function parseVietnameseDateTime(dateTimeStr) {
        try {
            // Format: "DD/MM/YYYY, HH:MM:SS" ho·∫∑c "DD/MM/YYYY HH:MM:SS"
            const parts = dateTimeStr.replace(',', '').split(' ');
            if (parts.length < 2) return null;
            
            const [day, month, year] = parts[0].split('/');
            const [hour, minute, second] = parts[1].split(':');
            
            return new Date(year, month - 1, day, hour, minute, second || 0);
        } catch (error) {
            console.error('Error parsing date:', dateTimeStr, error);
            return null;
        }
    }

    // ===== X·ª¨ L√ù NH·∫¨P SƒêT V√Ä T·ª∞ ƒê·ªòNG L·∫§Y TH√îNG TIN KH√ÅCH H√ÄNG =====
    async function getCustomerInfoByPhone(phone) {
        try {
            const response = await fetch(`/api/khachhang?phone=${phone}`);
            const khachHang = await response.json();
            
            const tenKHInput = document.getElementById('tenKH');
            const maKHInput = document.getElementById('maKH');
            const tenKHGroup = document.getElementById('tenKHGroup');
            
            if (khachHang && khachHang.MaKH) {
                // Kh√°ch h√†ng ƒë√£ t·ªìn t·∫°i
                tenKHInput.value = khachHang.TenKH || '';
                maKHInput.value = khachHang.MaKH;
                tenKHInput.readOnly = true;
                tenKHInput.style.background = '#f1f5f9';
                tenKHInput.style.cursor = 'not-allowed';
                
                // Hi·ªÉn th·ªã th√¥ng b√°o
                const smallTag = tenKHGroup.querySelector('small');
                if (smallTag) {
                    smallTag.innerHTML = '<i class="fas fa-check-circle" style="color: #10b981;"></i> Kh√°ch h√†ng ƒë√£ t·ªìn t·∫°i trong h·ªá th·ªëng';
                    smallTag.style.color = '#10b981';
                }
            } else {
                // Kh√°ch h√†ng m·ªõi
                tenKHInput.value = '';
                maKHInput.value = '';
                tenKHInput.readOnly = false;
                tenKHInput.style.background = '#fff';
                tenKHInput.style.cursor = 'text';
                tenKHInput.placeholder = 'Nh·∫≠p t√™n kh√°ch h√†ng m·ªõi';
                
                // Hi·ªÉn th·ªã th√¥ng b√°o
                const smallTag = tenKHGroup.querySelector('small');
                if (smallTag) {
                    smallTag.innerHTML = '<i class="fas fa-user-plus" style="color: #3b82f6;"></i> Kh√°ch h√†ng m·ªõi - vui l√≤ng nh·∫≠p t√™n';
                    smallTag.style.color = '#3b82f6';
                }
            }
            
            // Hi·ªÉn th·ªã field t√™n
            tenKHGroup.style.display = 'block';
            
        } catch (error) {
            console.log({info: 'L·ªói khi l·∫•y th√¥ng tin kh√°ch h√†ng', message: error.message});
            // V·∫´n cho ph√©p nh·∫≠p t√™n m·ªõi
            const tenKHInput = document.getElementById('tenKH');
            const tenKHGroup = document.getElementById('tenKHGroup');
            tenKHInput.value = '';
            tenKHInput.readOnly = false;
            tenKHInput.style.background = '#fff';
            tenKHInput.style.cursor = 'text';
            tenKHGroup.style.display = 'block';
        }
    }

    // Debounce function
    function debounce(func, delay) {
        let timerId;
        return function() {
            clearTimeout(timerId);
            timerId = setTimeout(() => func.apply(this, arguments), delay);
        };
    }

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', function () {
        allDatPhongs = Array.from(document.querySelectorAll('#datPhongTableBody tr'));
        filteredDatPhongs = [...allDatPhongs];

        calculateStatistics();

        // Event listener cho SƒêT - T·ª± ƒë·ªông l·∫•y th√¥ng tin kh√°ch h√†ng
        const sdtKHInput = document.getElementById('sdtKH');
        if (sdtKHInput) {
            const debouncedGetInfo = debounce(getCustomerInfoByPhone, 500);
            
            sdtKHInput.addEventListener('input', function(e) {
                const phone = e.target.value.trim();
                const tenKHGroup = document.getElementById('tenKHGroup');
                
                // Ch·ªâ ch·∫•p nh·∫≠n s·ªë
                this.value = this.value.replace(/[^0-9]/g, '');
                
                if (phone.length < 10) {
                    tenKHGroup.style.display = 'none';
                    return;
                }
                
                if (phone.length === 10) {
                    // G·ªçi API l·∫•y th√¥ng tin
                    debouncedGetInfo(phone);
                }
            });
        }

        // Event listeners
        const phongSelect = document.getElementById('phongSelect');
        const soNguoiInput = document.getElementById('soNguoi');
        const thoiGianBatDauInput = document.getElementById('thoiGianBatDau');
        const tenKHInput = document.getElementById('tenKH');
        
        if (phongSelect) {
            phongSelect.addEventListener('change', function() {
                loadPhongInfo();
                validateAllFields();
            });
        }
        
        if (soNguoiInput) {
            soNguoiInput.addEventListener('input', function() {
                validateSoNguoi();
                validateAllFields();
            });
        }
        
        if (thoiGianBatDauInput) {
            thoiGianBatDauInput.addEventListener('change', function() {
                updateGiaPhong();
                validateAllFields();
            });
        }
        
        if (tenKHInput) {
            tenKHInput.addEventListener('input', validateAllFields);
        }
        
        // Ki·ªÉm tra v√† t·ª± ƒë·ªông h·ªßy ƒë∆°n khi load trang
        checkAndAutoCancelBookings();
        
        // Ki·ªÉm tra ƒë·ªãnh k·ª≥ m·ªói 2 ph√∫t
        setInterval(checkAndAutoCancelBookings, 2 * 60 * 1000);
    });
</script>

<style>
    /* ===== RESET & VARIABLES ===== */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        --warning-gradient: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        --danger-gradient: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        --info-gradient: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.08);
        --shadow-medium: 0 8px 30px rgba(0, 0, 0, 0.12);
        --shadow-heavy: 0 12px 40px rgba(0, 0, 0, 0.15);
        --border-radius: 12px;
        --border-radius-lg: 16px;
        --border-radius-xl: 20px;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    /* ===== LAYOUT CH√çNH ===== */
    .main-content {
        margin-left: 280px;
        transition: margin-left 0.3s ease;
        min-height: 100vh;
        background: var(--bg-gradient);
    }

    .admin-dashboard {
        padding: 24px;
        min-height: 100vh;
    }

    /* ===== HEADER DASHBOARD ===== */
    .dashboard-header {
        background: var(--primary-gradient);
        border-radius: var(--border-radius-lg);
        padding: 28px;
        margin-bottom: 28px;
        box-shadow: var(--shadow-light);
        color: white;
        position: relative;
        overflow: hidden;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
        position: relative;
        z-index: 1;
    }

    .header-title {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .title-icon {
        font-size: 3rem;
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
    }

    .header-title h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
    }

    .header-title p {
        margin: 8px 0 0 0;
        opacity: 0.9;
        font-size: 1.1rem;
    }

    /* ===== N√öT CHUNG ===== */
    .btn-primary {
        background: var(--success-gradient);
        color: white;
        border: none;
        padding: 14px 24px;
        border-radius: var(--border-radius);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
    }

    .btn-secondary {
        background: #f1f5f9;
        border: 2px solid #e2e8f0;
        color: #64748b;
        padding: 14px 24px;
        border-radius: var(--border-radius);
        cursor: pointer;
        display: flex;
        align-items: center;
        transition: all 0.3s ease;
        font-weight: 600;
    }

    .btn-secondary:hover {
        background: #e2e8f0;
        color: #475569;
    }

    /* ===== THANH T√åM KI·∫æM & B·ªò L·ªåC ===== */
    .search-filter-bar {
        background: white;
        border-radius: var(--border-radius-lg);
        padding: 24px;
        margin-bottom: 28px;
        display: flex;
        gap: 24px;
        align-items: center;
        flex-wrap: wrap;
        box-shadow: var(--shadow-light);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .search-box {
        display: flex;
        align-items: center;
        background: #f8fafc;
        border-radius: var(--border-radius);
        padding: 12px 20px;
        flex: 1;
        min-width: 320px;
        border: 2px solid #e2e8f0;
        transition: all 0.3s ease;
    }

    .search-box:focus-within {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .search-box i {
        color: #64748b;
        margin-right: 12px;
        font-size: 1.1rem;
    }

    .search-box input {
        border: none;
        background: none;
        outline: none;
        flex: 1;
        padding: 8px 0;
        font-size: 1rem;
        color: #1e293b;
    }

    .search-btn {
        background: var(--primary-gradient);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        cursor: pointer;
        margin-left: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .filter-controls {
        display: flex;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
    }

    .filter-select {
        padding: 12px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        background: white;
        color: #475569;
        min-width: 180px;
        font-size: 1rem;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .clear-filters {
        background: #f1f5f9;
        border: 2px solid #e2e8f0;
        color: #64748b;
        padding: 12px 20px;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    /* ===== TH·ªêNG K√ä ===== */
    .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
        margin-bottom: 32px;
    }

    .stat-card {
        background: white;
        border-radius: var(--border-radius-xl);
        padding: 32px;
        display: flex;
        align-items: center;
        gap: 20px;
        box-shadow: var(--shadow-light);
        transition: all 0.3s ease;
        border: 1px solid rgba(0, 0, 0, 0.03);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-medium);
    }

    .stat-icon {
        width: 80px;
        height: 80px;
        border-radius: var(--border-radius-xl);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        box-shadow: var(--shadow-light);
    }

    .stat-icon.total {
        background: linear-gradient(135deg, #fed7d7, #feb2b2);
        color: #c53030;
    }

    .stat-icon.active {
        background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
        color: #276749;
    }

    .stat-icon.reception {
        background: linear-gradient(135deg, #fed7d7, #feb2b2);
        color: #c53030;
    }

    .stat-icon.service {
        background: linear-gradient(135deg, #fefcbf, #faf089);
        color: #d69e2e;
    }

    .stat-icon.technical {
        background: linear-gradient(135deg, #e9d8fd, #d6bcfa);
        color: #6b46c1;
    }

    .stat-icon.manager {
        background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
        color: #276749;
    }

    .stat-icon.security {
        background: linear-gradient(135deg, #fed7d7, #feb2b2);
        color: #c53030;
    }

    .stat-icon.fulltime {
        background: linear-gradient(135deg, #bee3f8, #90cdf4);
        color: #2c5aa0;
    }

    .stat-info h3 {
        margin: 0;
        font-size: 2.5rem;
        color: #1e293b;
        font-weight: 700;
    }

    .stat-info p {
        margin: 8px 0 0 0;
        color: #64748b;
        font-size: 1.1rem;
        font-weight: 500;
    }

    /* ===== B·∫¢NG ƒê·∫∂T PH√íNG ===== */
    .table-container {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.03);
        overflow-x: auto;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.95rem;
    }

    .data-table thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .data-table thead th {
        padding: 16px;
        text-align: left;
        font-weight: 600;
        font-size: 0.9rem;
        letter-spacing: 0.5px;
        white-space: nowrap;
        border-bottom: 3px solid rgba(255, 255, 255, 0.2);
    }

    .data-table tbody tr {
        border-bottom: 1px solid #e2e8f0;
        transition: all 0.3s ease;
    }

    .data-table tbody tr:hover {
        background: linear-gradient(to right, #f8fafc, #ffffff);
        transform: scale(1.01);
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }

    .data-table tbody tr:nth-child(even) {
        background: #f9fafb;
    }

    .data-table tbody tr:nth-child(even):hover {
        background: linear-gradient(to right, #f8fafc, #ffffff);
    }

    .data-table tbody td {
        padding: 16px;
        vertical-align: middle;
        color: #1e293b;
    }

    .booking-code {
        font-family: 'Courier New', monospace;
        background: #fef3c7;
        color: #92400e;
        padding: 4px 8px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .room-badge {
        display: inline-block;
        background: linear-gradient(135deg, #e9d8fd, #d6bcfa);
        color: #6b46c1;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .text-muted {
        color: #94a3b8;
        font-style: italic;
    }

    .status-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
        white-space: nowrap;
    }

    .status-badge.status-success {
        background: linear-gradient(135deg, #d1fae5, #a7f3d0);
        color: #065f46;
    }

    .status-badge.status-warning {
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        color: #92400e;
    }

    .status-badge.status-info {
        background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        color: #1e40af;
    }

    .status-badge.status-danger {
        background: linear-gradient(135deg, #fee2e2, #fecaca);
        color: #991b1b;
    }

    .table-actions {
        width: 200px;
    }

    .action-buttons {
        display: flex;
        gap: 6px;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
    }

    .btn-table-action {
        width: 36px;
        height: 36px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        color: white;
    }

    .btn-table-action.btn-detail {
        background: linear-gradient(135deg, #4299e1, #3182ce);
    }

    .btn-table-action.btn-checkin {
        background: linear-gradient(135deg, #48bb78, #38a169);
    }

    .btn-table-action.btn-checkout {
        background: linear-gradient(135deg, #ed8936, #dd6b20);
    }

    .btn-table-action.btn-edit {
        background: linear-gradient(135deg, #9f7aea, #805ad5);
        width: 36px !important;
        height: 36px !important;
    }

    .btn-table-action.btn-delete-table {
        background: linear-gradient(135deg, #f56565, #e53e3e);
        width: 36px !important;
        height: 36px !important;
    }

    .btn-table-action.btn-cancel {
        background: linear-gradient(135deg, #fc8181, #f56565);
        width: 36px !important;
        height: 36px !important;
    }

    .btn-table-action.btn-cancel:hover {
        background: linear-gradient(135deg, #f56565, #e53e3e);
    }

    .btn-table-action:hover {
        transform: translateY(-2px) scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* ===== PAGINATION ===== */
    .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 32px;
        padding: 20px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .pagination-info {
        color: #64748b;
        font-weight: 500;
        font-size: 0.95rem;
    }

    .pagination-info span {
        color: #1e293b;
        font-weight: 600;
    }

    .pagination-controls {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .page-numbers {
        display: flex;
        align-items: center;
        gap: 4px;
        flex-direction: row;
    }

    .pagination-btn {
        background: white;
        border: 2px solid #e2e8f0;
        color: #64748b;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-weight: 600;
    }

    .pagination-btn:hover:not(:disabled) {
        background: #667eea;
        border-color: #667eea;
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .pagination-btn:disabled {
        background: #f1f5f9;
        border-color: #e2e8f0;
        color: #cbd5e0;
        cursor: not-allowed;
    }

    .pagination-page {
        background: white;
        border: 2px solid #e2e8f0;
        color: #64748b;
        min-width: 40px;
        height: 40px;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .pagination-page:hover:not(.active) {
        background: #f8fafc;
        border-color: #667eea;
        color: #667eea;
        transform: translateY(-1px);
    }

    .pagination-page.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-color: #667eea;
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .pagination-ellipsis {
        color: #94a3b8;
        padding: 0 8px;
        font-weight: 600;
    }

    /* ===== OLD CARD STYLES (Keep for compatibility) ===== */
    .employees-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
        gap: 28px;
    }

    .employee-card {
        background: white;
        border-radius: var(--border-radius-xl);
        overflow: hidden;
        box-shadow: var(--shadow-light);
        transition: all 0.4s ease;
        border: 1px solid rgba(0, 0, 0, 0.03);
        position: relative;
    }

    .employee-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-heavy);
    }

    .employee-image {
        position: relative;
        height: 240px;
        overflow: hidden;
    }

    .employee-avatar-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }

    .employee-avatar-placeholder.booking {
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    }

    .employee-avatar-placeholder.booking i {
        font-size: 2rem;
    }

    .employee-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: all 0.4s ease;
    }

    .employee-card:hover .employee-overlay {
        opacity: 1;
    }

    .employee-actions {
        display: flex;
        gap: 16px;
    }

    .btn-edit,
    .btn-delete {
        width: 56px;
        height: 56px;
        border: none;
        border-radius: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-edit {
        background: var(--success-gradient);
        color: white;
    }

    .btn-delete {
        background: var(--danger-gradient);
        color: white;
    }

    .employee-badge {
        position: absolute;
        top: 16px;
        left: 16px;
        padding: 8px 16px;
        border-radius: 25px;
        font-size: 0.85rem;
        font-weight: 700;
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow-light);
        z-index: 2;
    }

    .employee-badge.S·∫Øp\ t·ªõi {
        background: linear-gradient(135deg, rgba(237, 137, 54, 0.95), rgba(217, 119, 6, 0.95));
        color: white;
    }

    .employee-badge.ƒêang\ s·ª≠\ d·ª•ng {
        background: linear-gradient(135deg, rgba(72, 187, 120, 0.95), rgba(56, 161, 105, 0.95));
        color: white;
    }

    .employee-badge.ƒê√£\ k·∫øt\ th√∫c {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.95), rgba(118, 75, 162, 0.95));
        color: white;
    }

    .employee-badge.ƒê√£\ h·ªßy {
        background: linear-gradient(135deg, rgba(245, 101, 101, 0.95), rgba(229, 62, 62, 0.95));
        color: white;
    }

    .employee-status {
        position: absolute;
        bottom: 16px;
        right: 16px;
        padding: 8px 16px;
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 700;
        box-shadow: var(--shadow-light);
        z-index: 2;
    }

    .employee-status.active {
        background: linear-gradient(135deg, rgba(72, 187, 120, 0.95), rgba(56, 161, 105, 0.95));
        color: white;
    }

    .employee-status.onleave {
        background: linear-gradient(135deg, rgba(237, 137, 54, 0.95), rgba(217, 119, 6, 0.95));
        color: white;
    }

    .employee-status.inactive {
        background: linear-gradient(135deg, rgba(245, 101, 101, 0.95), rgba(229, 62, 62, 0.95));
        color: white;
    }

    .employee-content {
        padding: 24px;
    }

    .employee-name {
        margin: 0 0 12px 0;
        color: #1e293b;
        font-size: 1.4rem;
        font-weight: 700;
    }

    .employee-code {
        margin: 0 0 20px 0;
        color: #64748b;
        font-size: 1rem;
        font-weight: 500;
    }

    .employee-details {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 20px;
    }

    .detail-item {
        display: flex;
        align-items: center;
        gap: 12px;
        color: #475569;
        font-size: 1rem;
    }

    .detail-item i {
        color: #667eea;
        width: 20px;
        font-size: 1.1rem;
    }

    /* ===== CHI TI·∫æT KH√ÅCH H√ÄNG TRONG CARD ===== */
    .customer-breakdown {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #e2e8f0;
    }

    .customer-breakdown h4 {
        margin-bottom: 8px;
        color: #374151;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .customer-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 0.9em;
    }

    .customer-name {
        font-weight: bold;
        color: #2d3748;
    }

    .customer-phone {
        color: #666;
    }

    /* ===== FOOTER CARD V·ªöI N√öT ===== */
    .employee-footer {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #e2e8f0;
    }

    .employee-footer button {
        flex: 1;
        padding: 10px 15px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .btn-detail {
        background: var(--info-gradient);
        color: white;
    }

    .btn-detail:hover {
        background: linear-gradient(135deg, #3182ce, #2c5aa0);
        transform: translateY(-2px);
    }

    .btn-checkin {
        background: var(--success-gradient);
        color: white;
    }

    .btn-checkin:hover {
        background: linear-gradient(135deg, #38a169, #2f855a);
        transform: translateY(-2px);
    }

    .btn-checkout {
        background: var(--warning-gradient);
        color: white;
    }

    .btn-checkout:hover {
        background: linear-gradient(135deg, #dd6b20, #c05621);
        transform: translateY(-2px);
    }

    /* ===== TR·∫†NG TH√ÅI R·ªñNG ===== */
    .empty-state {
        text-align: center;
        padding: 80px 40px;
        background: white;
        border-radius: var(--border-radius-xl);
        box-shadow: var(--shadow-light);
        border: 2px dashed #e2e8f0;
    }

    .empty-icon {
        font-size: 5rem;
        margin-bottom: 24px;
        opacity: 0.7;
    }

    .empty-state h3 {
        margin: 0 0 12px 0;
        color: #1e293b;
        font-size: 1.8rem;
        font-weight: 700;
    }

    .empty-state p {
        margin: 0 0 32px 0;
        color: #64748b;
        font-size: 1.2rem;
    }

    /* ===== MODAL CHUNG ===== */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
        backdrop-filter: blur(8px);
    }

    .modal-container {
        background: white;
        border-radius: 16px;
        width: 92%;
        max-width: 680px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: modalSlideIn 0.3s ease-out;
    }

    .modal-container.large {
        max-width: 900px;
    }

    .invoice-modal {
        max-width: 800px;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translateY(-30px) scale(0.9);
        }

        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 2px solid #f1f5f9;
        background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        border-radius: 16px 16px 0 0;
    }

    .modal-header h2 {
        margin: 0;
        color: #1e293b;
        font-size: 1.5rem;
        font-weight: 700;
    }

    .modal-close {
        background: #f1f5f9;
        border: none;
        font-size: 1.2rem;
        color: #64748b;
        cursor: pointer;
        padding: 0;
        border-radius: 8px;
        transition: all 0.2s ease;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-close:hover {
        background: #e2e8f0;
        color: #1e293b;
    }

    .modal-body {
        padding: 24px;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        padding: 16px 24px;
        border-top: 2px solid #f1f5f9;
        background: #f8fafc;
        border-radius: 0 0 16px 16px;
    }

    /* ===== FORM TRONG MODAL ===== */
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 0;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 0;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-group label {
        margin-bottom: 6px;
        color: #374151;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        padding: 10px 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: all 0.2s ease;
        background: white;
        height: 42px;
    }

    .form-group textarea {
        height: auto;
        min-height: 70px;
        resize: vertical;
    }

    .form-group select {
        cursor: pointer;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        transform: translateY(-1px);
    }

    /* ===== HEADER MODAL ƒê·∫∂T PH√íNG HI·ªÜN ƒê·∫†I ===== */
    .modal-header.invoice-company-header {
        background: var(--primary-gradient);
        color: white;
        padding: 25px 30px 20px;
        border-radius: var(--border-radius-xl) var(--border-radius-xl) 0 0;
        display: block;
    }

    /* H√†ng 1: Logo v√† n√∫t h√†nh ƒë·ªông */
    .header-top-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .company-logo {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .logo-placeholder {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
    }

    .company-info h1 {
        margin: 0 0 5px 0;
        font-size: 22px;
        font-weight: 700;
        line-height: 1.2;
    }

    .company-info p {
        margin: 0;
        font-size: 13px;
        opacity: 0.9;
        line-height: 1.3;
    }

    .header-actions {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .btn-print-invoice,
    .btn-download-invoice,
    .btn-pay-invoice {
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        backdrop-filter: blur(10px);
    }

    .btn-print-invoice:hover,
    .btn-download-invoice:hover,
    .btn-pay-invoice:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
    }

    .btn-pay-invoice {
        background: var(--success-gradient);
    }

    .modal-close {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        font-size: 16px;
    }

    .modal-close:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
    }

    /* H√†ng 2: Ti√™u ƒë·ªÅ */
    .header-title-row {
        text-align: center;
        margin: 40px 0px 15px 0px;
    }

    .header-title-row h2 {
        margin: 0;
        font-size: 34px;
        font-weight: 700;
        color: white;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* H√†ng 3: Th√¥ng tin ƒë·∫∑t ph√≤ng */
    .header-meta-row {
        display: flex;
        justify-content: center;
        gap: 30px;
        flex-wrap: wrap;
    }

    .meta-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .meta-item .label {
        font-size: 13px;
        opacity: 0.8;
        margin-bottom: 4px;
        font-weight: 500;
    }

    .meta-item .value {
        font-size: 16px;
        font-weight: 600;
    }

    .status-badge {
        padding: 3px 6px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
    }

    .status-badge.active {
        background: rgba(72, 187, 120, 0.9);
        color: white;
    }

    .status-badge.pending {
        background: rgba(237, 137, 54, 0.9);
        color: white;
    }

    .status-badge.completed {
        background: rgba(102, 126, 234, 0.9);
        color: white;
    }

    .status-badge.cancelled {
        background: rgba(245, 101, 101, 0.9);
        color: white;
    }

    /* ===== ƒê·∫∂T PH√íNG CHI TI·∫æT HI·ªÜN ƒê·∫†I ===== */
    .modern-invoice {
        background: white;
        border-radius: 0 0 12px 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .invoice-customer-info {
        padding: 25px 30px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        border-bottom: 1px solid #e2e8f0;
    }

    .info-section h3 {
        margin: 0 0 15px 0;
        color: #2d3748;
        font-size: 16px;
        font-weight: 600;
    }

    .info-grid {
        display: grid;
        gap: 10px;
    }

    .info-item {
        display: flex;
        justify-content: space-between;
    }

    .info-item .label {
        color: #718096;
        font-weight: 500;
    }

    .info-item .value {
        color: #2d3748;
        font-weight: 600;
    }

    .invoice-services {
        padding: 25px 30px;
        border-bottom: 1px solid #e2e8f0;
    }

    .invoice-services h3 {
        margin: 0 0 20px 0;
        color: #2d3748;
        font-size: 18px;
        font-weight: 600;
    }

    .services-table {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        overflow: hidden;
    }

    .table-header {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        background: #f7fafc;
        padding: 15px 20px;
        font-weight: 600;
        color: #4a5568;
        border-bottom: 1px solid #e2e8f0;
    }

    .table-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        padding: 15px 20px;
        border-bottom: 1px solid #e2e8f0;
    }

    .table-row:last-child {
        border-bottom: none;
    }

    .table-row.no-services {
        grid-template-columns: 1fr;
        text-align: center;
        color: #718096;
        font-style: italic;
    }

    .col-service .service-name {
        display: block;
        font-weight: 500;
        color: #2d3748;
    }

    .col-service .service-desc {
        display: block;
        font-size: 12px;
        color: #718096;
        margin-top: 4px;
    }

    .col-date,
    .col-time {
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
    }

    .invoice-summary {
        padding: 25px 30px;
        border-bottom: 1px solid #e2e8f0;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
    }

    .summary-row.total {
        border-top: 2px solid #e2e8f0;
        margin-top: 10px;
        padding-top: 15px;
        font-size: 18px;
        font-weight: 700;
        color: #2d3748;
    }

    .invoice-payment {
        padding: 25px 30px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        border-bottom: 1px solid #e2e8f0;
    }

    .payment-method h4,
    .payment-notes h4 {
        margin: 0 0 15px 0;
        color: #2d3748;
        font-size: 16px;
        font-weight: 600;
    }

    .method {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 15px;
        background: #f7fafc;
        border-radius: 8px;
        font-weight: 500;
    }

    .method.paid {
        color: #48bb78;
    }

    .method.cash {
        color: #ed8936;
    }

    .payment-notes p {
        margin: 5px 0;
        color: #718096;
        font-size: 14px;
    }

    .payment-notes.full-width {
        grid-column: 1 / -1;
    }

    .invoice-footer {
        padding: 25px 30px;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
    }

    .footer-signature {
        text-align: center;
    }

    .signature-line {
        width: 200px;
        height: 1px;
        background: #2d3748;
        margin-bottom: 5px;
    }

    .footer-signature p {
        margin: 0;
        color: #718096;
        font-size: 14px;
    }

    .footer-thanks {
        text-align: right;
    }

    .footer-thanks p {
        margin: 2px 0;
        color: #4a5568;
    }

    /* ===== TR·∫†NG TH√ÅI LOADING V√Ä ERROR ===== */
    .loading-invoice {
        text-align: center;
        padding: 60px 20px;
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .error-state {
        text-align: center;
        padding: 60px 20px;
    }

    .error-icon {
        font-size: 48px;
        margin-bottom: 20px;
    }

    .error-state h3 {
        margin: 0 0 10px 0;
        color: #2d3748;
    }

    .error-state p {
        margin: 0 0 20px 0;
        color: #718096;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
        .main-content {
            margin-left: 0 !important;
            padding: 16px;
        }

        .admin-dashboard {
            padding: 16px;
        }

        .header-content {
            flex-direction: column;
            align-items: stretch;
            text-align: center;
        }

        .header-title {
            justify-content: center;
            text-align: center;
        }

        .search-filter-bar {
            flex-direction: column;
            align-items: stretch;
            padding: 20px;
        }

        .search-box {
            min-width: auto;
            margin-bottom: 16px;
        }

        .filter-controls {
            flex-direction: column;
            align-items: stretch;
        }

        .filter-select {
            min-width: auto;
        }

        .form-grid {
            grid-template-columns: 1fr;
        }

        .employees-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .stats-overview {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .modal-container {
            margin: 10px;
            max-width: none;
        }

        .employee-footer {
            flex-direction: column;
        }

        .invoice-customer-info,
        .invoice-payment {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .table-header,
        .table-row {
            grid-template-columns: 1fr;
            text-align: center;
            gap: 10px;
        }

        .col-date,
        .col-time {
            justify-content: center;
        }

        /* Table Responsive */
        .table-container {
            border-radius: 12px;
            margin: 0 -16px;
        }

        .data-table {
            font-size: 0.8rem;
        }

        .data-table thead th,
        .data-table tbody td {
            padding: 10px 8px;
        }

        .btn-table-action {
            width: 32px;
            height: 32px;
            font-size: 0.85rem;
        }

        .action-buttons {
            gap: 4px;
        }

        .status-badge,
        .room-badge,
        .booking-code {
            font-size: 0.75rem;
            padding: 4px 8px;
        }

        .pagination-container {
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
        }

        .pagination-info {
            width: 100%;
            text-align: center;
            order: 2;
        }

        .pagination-controls {
            order: 1;
        }

        .invoice-footer {
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .footer-signature,
        .footer-thanks {
            text-align: center;
        }

        /* Responsive cho header modal ƒë·∫∑t ph√≤ng */
        .modal-header.invoice-company-header {
            padding: 20px 15px 15px;
        }

        .header-top-row {
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }

        .company-logo {
            flex-direction: column;
            text-align: center;
            gap: 10px;
        }

        .company-info h1 {
            font-size: 20px;
        }

        .company-info p {
            font-size: 12px;
        }

        .header-actions {
            width: 100%;
            justify-content: center;
        }

        .header-title-row h2 {
            font-size: 20px;
        }

        .header-meta-row {
            gap: 15px;
        }

        .meta-item .label {
            font-size: 12px;
        }

        .meta-item .value {
            font-size: 14px;
        }

        .btn-print-invoice,
        .btn-download-invoice,
        .btn-pay-invoice {
            padding: 8px 12px;
            font-size: 12px;
        }
    }

    @media (max-width: 480px) {
        .header-meta-row {
            flex-direction: column;
            gap: 10px;
        }

        .meta-item {
            flex-direction: row;
            justify-content: space-between;
            width: 100%;
        }

        .meta-item .label {
            margin-bottom: 0;
        }
    }

    /* ===== CSS CHO IN ·∫§N ƒê·∫∂T PH√íNG ===== */
    @media print {
        body {
            margin: 0;
            padding: 20px;
            background: white !important;
        }

        .modern-invoice {
            box-shadow: none;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 0;
        }

        .btn-print-invoice,
        .btn-download-invoice,
        .btn-pay-invoice,
        .modal-close,
        .modal-header .invoice-actions {
            display: none !important;
        }

        .modal-overlay {
            position: static;
            background: none;
            backdrop-filter: none;
        }

        .modal-container {
            box-shadow: none;
            max-width: none;
            max-height: none;
        }
    }

    /* ===== N√öT THO√ÅT TRONG MODAL CHI TI·∫æT ===== */
    .btn-close-detail {
        background: rgba(245, 101, 101, 0.9);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .btn-close-detail:hover {
        background: rgba(229, 62, 62, 0.9);
        transform: translateY(-2px);
    }

    .btn-checkin-detail {
        background: rgba(72, 187, 120, 0.9);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .btn-checkin-detail:hover {
        background: rgba(56, 161, 105, 0.9);
        transform: translateY(-2px);
    }

    .btn-checkout-detail {
        background: rgba(237, 137, 54, 0.9);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .btn-checkout-detail:hover {
        background: rgba(217, 119, 6, 0.9);
        transform: translateY(-2px);
    }

    /* ===== MODAL OVERLAY - CLICK RA NGO√ÄI ƒê·ªÇ ƒê√ìNG ===== */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
        backdrop-filter: blur(8px);
        cursor: pointer;
    }

    .modal-container {
        cursor: default;
    }

    /* ===== RESPONSIVE CHO N√öT H√ÄNH ƒê·ªòNG ===== */
    @media (max-width: 768px) {

        .btn-close-detail,
        .btn-checkin-detail,
        .btn-checkout-detail {
            padding: 8px 12px;
            font-size: 12px;
        }

        .header-actions {
            flex-wrap: wrap;
            justify-content: center;
        }
    }

    /* ===== N√öT TRONG MODAL CHI TI·∫æT ===== */
    .btn-checkin-detail {
        background: rgba(72, 187, 120, 0.9);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .btn-checkin-detail:hover {
        background: rgba(56, 161, 105, 0.9);
        transform: translateY(-2px);
    }

    .btn-checkout-detail {
        background: rgba(237, 137, 54, 0.9);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .btn-checkout-detail:hover {
        background: rgba(217, 119, 6, 0.9);
        transform: translateY(-2px);
    }

    /* ===== MODAL OVERLAY - CLICK RA NGO√ÄI ƒê·ªÇ ƒê√ìNG ===== */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
        backdrop-filter: blur(8px);
        cursor: pointer;
    }

    .modal-container {
        cursor: default;
    }
    
    /* ===== SWEETALERT2 Z-INDEX FIX ===== */
    .swal2-top-level {
        z-index: 20000 !important;
    }
    
    .swal2-container {
        z-index: 20000 !important;
    }

    /* ===== RESPONSIVE CHO N√öT H√ÄNH ƒê·ªòNG ===== */
    @media (max-width: 768px) {

        .btn-checkin-detail,
        .btn-checkout-detail {
            padding: 8px 12px;
            font-size: 12px;
        }

        .header-actions {
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
    }
</style>